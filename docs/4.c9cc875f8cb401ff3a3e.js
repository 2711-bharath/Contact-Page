(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{VfWa:function(t,e,n){"use strict";n.r(e),n.d(e,"CarreirModuleModule",function(){return Up});class r{constructor(t){this.id=t.id,this.name=t.name,this.email=t.email,this.mobile=t.mobile,this.landline=t.landline,this.website=t.website,this.address=t.address}}var i=n("3Pt+"),o=n("fXoL"),s=n("HDdC"),a=n("D0XW"),u=n("Cfvw"),c=n("LRne"),h=n("JX91"),l=n("7o/Q");function f(){return t=>t.lift(new d)}class d{call(t,e){return e.subscribe(new p(t))}}class p extends l.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var y=n("lJxs"),m=n("Kqap"),v=n("/uUt"),g=n("pLZG"),b=n("pxpQ"),w=n("spgP"),I=n("ofXK"),E=n("Jgta"),T=n("zIRd"),_=n("qOnz"),O=n("q/0M"),S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var D,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C=C||{},x=N||self;function k(){}function j(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function F(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:F).apply(null,arguments)}function q(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function V(){return Date.now()}function B(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function K(){this.j=this.j,this.i=this.i}K.prototype.j=!1,K.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,R)&&t[R]||(t[R]=++L)}(this)},K.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var X,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:t>e?1:0}t:{var Z=x.navigator;if(Z){var tt=Z.userAgent;if(tt){X=tt;break t}}X=""}function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e={};for(var n in t)e[n]=t[n];return e}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<rt.length;o++)n=rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){return ot[" "](t),t}ot[" "]=k;var st,at,ut=J(X,"Opera"),ct=J(X,"Trident")||J(X,"MSIE"),ht=J(X,"Edge"),lt=ht||ct,ft=J(X,"Gecko")&&!(J(X.toLowerCase(),"webkit")&&!J(X,"Edge"))&&!(J(X,"Trident")||J(X,"MSIE"))&&!J(X,"Edge"),dt=J(X.toLowerCase(),"webkit")&&!J(X,"Edge");function pt(){var t=x.document;return t?t.documentMode:void 0}t:{var yt="",mt=(at=X,ft?/rv:([^\);]+)(\)|;)/.exec(at):ht?/Edge\/([\d\.]+)/.exec(at):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(at):dt?/WebKit\/(\S+)/.exec(at):ut?/(?:Version)[ \/]?(\S+)/.exec(at):void 0);if(mt&&(yt=mt?mt[1]:""),ct){var vt=pt();if(null!=vt&&vt>parseFloat(yt)){st=String(vt);break t}}st=yt}var gt={};function bt(t){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=Y(String(st)).split("."),r=Y(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=$(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||$(0==s[2].length,0==a[2].length)||$(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var wt=x.document&&ct&&(pt()||parseInt(st,10))||void 0,It=!ct||9<=Number(wt),Et=ct&&!bt("9"),Tt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",k,e),x.removeEventListener("test",k,e)}catch(n){}return t}();function _t(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Ot(t,e){if(_t.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{ot(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:St[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}_t.prototype.b=function(){this.defaultPrevented=!0},B(Ot,_t);var St={2:"touch",3:"pen",4:"mouse"};Ot.prototype.b=function(){Ot.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var At="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Nt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Dt,this.Y=this.Z=!1}function Ct(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function xt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Q(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ct(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function jt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=jt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Nt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Rt={};function Lt(t,e,n,r,i){if(r&&r.once)return Ft(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Lt(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.va(e,n,P(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!It)return null;var a=Qt(t);if(a||(t[Pt]=a=new xt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Kt,e=It?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ft(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ft(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.wa(e,n,P(r)?!!r.capture:!!r,i):Mt(t,e,n,!0,r,i)}function Ut(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);else r=P(r)?!!r.capture:!!r,n=zt(n),t&&t[At]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=jt(o=t.a[e],n,r,i))&&(Ct(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Qt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=jt(e,n,r,i)),(n=-1<t?e[t]:null)&&qt(n))}function qt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[At])kt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Qt(e))?(kt(n,t),0==n.b&&(n.src=null,e[Pt]=null)):Ct(t)}}}function Vt(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Bt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&qt(t),n.call(r,e)}function Kt(t,e){if(t.Y)return!0;if(!It){if(!e)t:{e=["window","event"];for(var n=x,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Bt(t,e=new Ot(e,this))}return Bt(t,new Ot(e,this))}function Qt(t){return(t=t[Pt])instanceof xt?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(t){return"function"==typeof t?t:(t[Gt]||(t[Gt]=function(e){return t.handleEvent(e)}),t[Gt])}function Ht(){K.call(this),this.c=new xt(this),this.J=this,this.C=null}function Wt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new _t(e,t);else if(e instanceof _t)e.target=e.target||t;else{var i=e;it(e=new _t(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Xt(s,r,!0,e)&&i}if(i=Xt(s=e.a=t,r,!0,e)&&i,i=Xt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Xt(s=e.a=n[o],r,!1,e)&&i}function Xt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&kt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}B(Ht,K),Ht.prototype[At]=!0,(D=Ht.prototype).addEventListener=function(t,e,n,r){Lt(this,t,e,n,r)},D.removeEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},D.G=function(){if(Ht.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ct(n[r]);delete e.a[t],e.b--}}this.C=null},D.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},D.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Yt=x.JSON.stringify;function Jt(){this.b=this.a=null}var $t,Zt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new ee},function(t){t.reset()});function te(){var t=oe,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function ee(){this.next=this.b=this.a=null}function ne(t){x.setTimeout(function(){throw t},0)}function re(t,e){$t||function(){var t=x.Promise.resolve(void 0);$t=function(){t.then(se)}}(),ie||($t(),ie=!0),oe.add(t,e)}Jt.prototype.add=function(t,e){var n=Zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ee.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},ee.prototype.reset=function(){this.next=this.b=this.a=null};var ie=!1,oe=new Jt;function se(){for(var t;t=te();){try{t.a.call(t.b)}catch(n){ne(n)}var e=Zt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ie=!1}function ae(t,e){Ht.call(this),this.b=t||1,this.a=e||x,this.f=U(this.Za,this),this.g=V()}function ue(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ce(t,e,n){if("function"==typeof t)n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}function he(t){t.a=ce(function(){t.a=null,t.c&&(t.c=!1,he(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}B(ae,Ht),(D=ae.prototype).aa=!1,D.M=null,D.Za=function(){if(this.aa){var t=V()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Wt(this,"tick"),this.aa&&(ue(this),this.start()))}},D.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=V())},D.G=function(){ae.X.G.call(this),ue(this),delete this.a};var le=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}S(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:he(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(x.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(K);function fe(t){K.call(this),this.b=t,this.a={}}B(fe,K);var de=[];function pe(t,e,n,r){Array.isArray(n)||(n&&(de[0]=n.toString()),n=de);for(var i=0;i<n.length;i++){var o=Lt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ye(t){et(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function me(){this.a=!0}function ve(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Yt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}fe.prototype.G=function(){fe.X.G.call(this),ye(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},me.prototype.info=function(){};var ge={},be=null;function we(){return be=be||new Ht}function Ie(t){_t.call(this,ge.Fa,t)}function Ee(t){var e=we();Wt(e,new Ie(e,t))}function Te(t,e){_t.call(this,ge.STAT_EVENT,t),this.stat=e}function _e(t){var e=we();Wt(e,new Te(e,t))}function Oe(t){_t.call(this,ge.Ga,t)}function Se(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){t()},e)}ge.Fa="serverreachability",B(Ie,_t),ge.STAT_EVENT="statevent",B(Te,_t),ge.Ga="timingevent",B(Oe,_t);var Ae={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},De={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ne(){}function Ce(){}Ne.prototype.a=null;var xe,ke={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function je(){_t.call(this,"d")}function Pe(){_t.call(this,"c")}function Re(){}function Le(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new fe(this),this.P=Me,this.R=new ae(t=lt?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}B(je,_t),B(Pe,_t),B(Re,Ne),xe=new Re;var Me=45e3,Fe={},Ue={};function qe(t,e,n){t.H=1,t.i=cn(nn(e)),t.j=n,t.I=!0,Ve(t,null)}function Ve(t,e){t.u=V(),Qe(t),t.l=nn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),En(n.b,"t",r),t.D=0,t.a=mr(t.g,t.g.C?e:null),0<t.O&&(t.F=new le(U(t.Ca,t,t.a),t.O)),pe(t.J,t.a,"readystatechange",t.Xa),e=t.B?nt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ee(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Be(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Ke(t,n);if(i==Ue){4==e&&(t.h=4,_e(14),r=!1),ve(t.c,t.f,null,"[Incomplete Response]");break}if(i==Fe){t.h=4,_e(15),ve(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}ve(t.c,t.f,i,null),Xe(t,i)}4==e&&0==n.length&&(t.h=1,_e(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),ur(e),e.F=!0,_e(11))):(ve(t.c,t.f,n,"[Invalid Chunked Response]"),We(t),He(t))}function Ke(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Ue:(n=Number(e.substring(n,r)),isNaN(n)?Fe:(r+=1)+n>e.length?Ue:(e=e.substr(r,n),t.D=r+n,e))}function Qe(t){t.T=V()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Se(U(t.Va,t),e)}function ze(t){t.o&&(x.clearTimeout(t.o),t.o=null)}function He(t){0==t.g.v||t.A||lr(t.g,t)}function We(t){ze(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ue(t.R),ye(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Xe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Nn(n.b,t)))if(n.I=t.N,!t.C&&Nn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(td){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;hr(n),Zn(n)}ar(n),_e(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Se(U(n.Sa,n),6e3));if(1>=Dn(n.b)&&n.ea){try{n.ea()}catch(td){}n.ea=void 0}}else dr(n,11)}else if((t.C||n.a==t)&&hr(n),!W(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(J(h,"spdy")||J(h,"quic")||J(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(Cn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,un(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=V()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=yr(u,u.C?u.ga:null,u.fa),d.C){xn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(ze(p),Qe(p)),u.a=d}else sr(u);0<n.g.length&&nr(n)}else"stop"!=i[0]&&"close"!=i[0]||dr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?dr(n,7):$n(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);Ee(4)}catch(td){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(j(t)||"string"==typeof t)G(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(j(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(j(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Je(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Je)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function $e(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ze(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ze(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(D=Le.prototype).setTimeout=function(t){this.P=t},D.Xa=function(t){t=t.target;var e=this.F;e&&3==Wn(t)?e.f():this.Ca(t)},D.Ca=function(t){try{if(t==this.a)t:{var e=Wn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!lt&&!this.a.$())){this.A||4!=e||7==n||Ee(8==n||0>=r?3:2),ze(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,_e(12),We(this),He(this);break t}ve(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Xe(this,u)}this.I?(Be(this,e,o),lt&&this.b&&3==e&&(pe(this.J,this.R,"tick",this.Wa),this.R.start())):(ve(this.c,this.f,o,null),Xe(this,o)),4==e&&We(this),this.b&&!this.A&&(4==e?lr(this.g,this):(this.b=!1,Qe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,_e(12)):(this.h=0,_e(13)),We(this),He(this)}}}catch(c){}},D.Wa=function(){if(this.a){var t=Wn(this.a),e=this.a.$();this.D<e.length&&(ze(this),Be(this,t,e),this.b&&4!=t&&Qe(this))}},D.cancel=function(){this.A=!0,We(this)},D.Va=function(){this.o=null;var t=V();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(Ee(3),_e(17)),We(this),this.h=2,He(this)):Ge(this,this.T-t)},(D=Je.prototype).K=function(){$e(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},D.L=function(){return $e(this),this.a.concat()},D.get=function(t,e){return Ze(this.b,t)?this.b[t]:e},D.set=function(t,e){Ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},D.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var tn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function en(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof en){this.a=void 0!==e?e:t.a,rn(this,t.f),this.j=t.j,on(this,t.c),sn(this,t.h),this.g=t.g,e=t.b;var n=new gn;n.c=e.c,e.a&&(n.a=new Je(e.a),n.b=e.b),an(this,n),this.i=t.i}else t&&(n=String(t).match(tn))?(this.a=!!e,rn(this,n[1]||"",!0),this.j=hn(n[2]||""),on(this,n[3]||"",!0),sn(this,n[4]),this.g=hn(n[5]||"",!0),an(this,n[6]||"",!0),this.i=hn(n[7]||"")):(this.a=!!e,this.b=new gn(null,this.a))}function nn(t){return new en(t)}function rn(t,e,n){t.f=n?hn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function on(t,e,n){t.c=n?hn(e,!0):e}function sn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function an(t,e,n){e instanceof gn?(t.b=e,function(t,e){e&&!t.f&&(bn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(wn(this,e),En(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=ln(e,mn)),t.b=new gn(e,t.a))}function un(t,e,n){t.b.set(e,n)}function cn(t){return un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),t}function hn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ln(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}en.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ln(e,dn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(ln(e,dn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(ln(n,"/"==n.charAt(0)?yn:pn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",ln(n,vn)),t.join("")};var dn=/[#\/\?@]/g,pn=/[#\?:]/g,yn=/[#\?]/g,mn=/[#\?@]/g,vn=/#/g;function gn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function bn(t){t.a||(t.a=new Je,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function wn(t,e){bn(t),e=Tn(t,e),Ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ze((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&$e(t)))}function In(t,e){return bn(t),e=Tn(t,e),Ze(t.a.b,e)}function En(t,e,n){wn(t,e),0<n.length&&(t.c=null,t.a.set(Tn(t,e),H(n)),t.b+=n.length)}function Tn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(D=gn.prototype).add=function(t,e){bn(this),this.c=null,t=Tn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},D.forEach=function(t,e){bn(this),this.a.forEach(function(n,r){G(n,function(n){t.call(e,n,r,this)},this)},this)},D.L=function(){bn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},D.K=function(t){bn(this);var e=[];if("string"==typeof t)In(this,t)&&(e=z(e,this.a.get(Tn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},D.set=function(t,e){return bn(this),this.c=null,In(this,t=Tn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},D.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},D.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var _n=function(){return function(t,e){this.b=t,this.a=e}}();function On(t){this.g=t||Sn,t=x.PerformanceNavigationTiming?0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(x.ia&&x.ia.ya&&x.ia.ya()&&x.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Sn=10;function An(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Dn(t){return t.b?1:t.a?t.a.size:0}function Nn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function Cn(t,e){t.a?t.a.add(e):t.b=e}function xn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function kn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return H(t.c)}function jn(){}function Pn(){this.a=new jn}function Rn(t,e,n){var r=n||"";try{Ye(t,function(t,n){var i=t;P(t)&&(i=Yt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Rd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Rd}}function Ln(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}On.prototype.cancel=function(){var t,e;if(this.c=kn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},jn.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},jn.prototype.parse=function(t){return x.JSON.parse(t,void 0)};var Mn=x.JSON.parse;function Fn(t){Ht.call(this),this.headers=new Je,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Un,this.D=this.F=!1}B(Fn,Ht);var Un="",qn=/^https?$/i,Vn=["POST","PUT"];function Bn(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Qn(t),zn(t)}function Qn(t){t.u||(t.u=!0,Wt(t,"complete"),Wt(t,"error"))}function Gn(t){if(t.b&&void 0!==C&&(!t.s[1]||4!=Wn(t)||2!=t.W()))if(t.l&&4==Wn(t))ce(t.za,0,t);else if(Wt(t,"readystatechange"),4==Wn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(tn)[1]||null;if(!o&&x.self&&x.self.location){var s=x.self.location.protocol;o=s.substr(0,s.length-1)}i=!qn.test(o?o.toLowerCase():"")}e=i}if(e)Wt(t,"complete"),Wt(t,"success");else{t.h=6;try{var a=2<Wn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Qn(t)}}finally{zn(t)}}}function zn(t,e){if(t.a){Hn(t);var n=t.a,r=t.s[0]?k:null;t.a=null,t.s=null,e||Wt(t,"ready");try{n.onreadystatechange=r}catch(Rd){}}}function Hn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(x.clearTimeout(t.m),t.m=null)}function Wn(t){return t.a?t.a.readyState:0}function Xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return et(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):un(t,e,n))}function Yn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Jn(t){this.pa=0,this.g=[],this.c=new me,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Yn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Yn("baseRetryDelayMs",5e3,t),this.Ra=Yn("retryDelaySeedMs",1e4,t),this.Ma=Yn("forwardChannelMaxRetries",2,t),this.ma=Yn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new On(t&&t.concurrentRequestLimit),this.ka=new Pn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function $n(t){if(tr(t),3==t.v){var e=t.R++,n=nn(t.B);un(n,"SID",t.J),un(n,"RID",e),un(n,"TYPE","terminate"),ir(t,n),(e=new Le(t,t.c,e,void 0)).H=2,e.i=cn(nn(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.i.toString(),"")),!n&&x.Image&&((new Image).src=e.i,n=!0),n||(e.a=mr(e.g,null),e.a.ba(e.i)),e.u=V(),Qe(e)}pr(t)}function Zn(t){t.a&&(ur(t),t.a.cancel(),t.a=null)}function tr(t){Zn(t),t.j&&(x.clearTimeout(t.j),t.j=null),hr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&x.clearTimeout(t.h),t.h=null)}function er(t,e){t.g.push(new _n(t.Oa++,e)),3==t.v&&nr(t)}function nr(t){An(t.b)||t.h||(t.h=!0,re(t.Ba,t),t.u=0)}function rr(t,e){var n;n=e?e.f:t.R++;var r=nn(t.B);un(r,"SID",t.J),un(r,"RID",n),un(r,"AID",t.P),ir(t,r),t.i&&t.l&&Xn(r,t.i,t.l),n=new Le(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=or(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Cn(t.b,n),qe(n,r,e)}function ir(t,e){t.f&&Ye({},function(t,n){un(e,n,t)})}function or(t,e,n){n=Math.min(t.g.length,n);var r=t.f?U(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{Rn(h,s,"req"+c+"_")}catch(Wr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function sr(t){t.a||t.j||(t.T=1,re(t.Aa,t),t.o=0)}function ar(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Se(U(t.Aa,t),fr(t,t.o)),t.o++,0))}function ur(t){null!=t.s&&(x.clearTimeout(t.s),t.s=null)}function cr(t){t.a=new Le(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=nn(t.la);un(e,"RID","rpc"),un(e,"SID",t.J),un(e,"CI",t.H?"0":"1"),un(e,"AID",t.P),ir(t,e),un(e,"TYPE","xmlhttp"),t.i&&t.l&&Xn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=cn(nn(e)),n.j=null,n.I=!0,Ve(n,t)}function hr(t){null!=t.m&&(x.clearTimeout(t.m),t.m=null)}function lr(t,e){var n=null;if(t.a==e){hr(t),ur(t),t.a=null;var r=2}else{if(!Nn(t.b,e))return;n=e.s,xn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=V()-e.u;var i=t.u;Wt(r=we(),new Oe(r,n,e,i)),nr(t)}else sr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Dn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Se(U(t.Ba,t,e),fr(t,t.u)),t.u++,0)))}(t,e)||2==r&&ar(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:dr(t,5);break;case 4:dr(t,10);break;case 3:dr(t,6);break;default:dr(t,2)}}function fr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function dr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=U(t.Ya,t);n||(n=new en("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||rn(n,"https"),cn(n)),function(t,e){var n=new me;if(x.Image){var r=new Image;r.onload=q(Ln,n,r,"TestLoadImage: loaded",!0,e),r.onerror=q(Ln,n,r,"TestLoadImage: error",!1,e),r.onabort=q(Ln,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=q(Ln,n,r,"TestLoadImage: timeout",!1,e),x.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else _e(2);t.v=0,t.f&&t.f.ra(e),pr(t),tr(t)}function pr(t){t.v=0,t.I=-1,t.f&&(0==kn(t.b).length&&0==t.g.length||(t.b.c.length=0,H(t.g),t.g.length=0),t.f.qa())}function yr(t,e,n){var r=function(t){return t instanceof en?nn(t):new en(t,void 0)}(n);if(""!=r.c)e&&on(r,e+"."+r.c),sn(r,r.h);else{var i=x.location;r=function(t,e,n,r){var i=new en(null,void 0);return t&&rn(i,t),e&&on(i,e),n&&sn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&et(t.V,function(t,e){un(r,e,t)}),n=t.na,(e=t.A)&&n&&un(r,e,n),un(r,"VER",t.ha),ir(t,r),r}function mr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Fn(t.Na)).F=t.C,e}function vr(){}function gr(){if(ct&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function br(t,e){Ht.call(this),this.a=new Jn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Er(this)}function wr(t){je.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Pe.call(this),this.status=1}function Er(t){this.a=t}(D=Fn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:xe),this.a.onreadystatechange=U(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Kn(this,o)}t=n||"";var i=new Je(this.headers);r&&Ye(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Bn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=x.FormData&&t instanceof x.FormData,!(0<=Q(Vn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Hn(this),0<this.o&&((this.D=function(t){return ct&&bt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=U(this.xa,this)):this.m=ce(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Kn(this,o)}},D.xa=function(){void 0!==C&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Wt(this,"timeout"),this.abort(8))},D.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Wt(this,"complete"),Wt(this,"abort"),zn(this))},D.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),zn(this,!0)),Fn.X.G.call(this)},D.za=function(){this.j||(this.A||this.l||this.g?Gn(this):this.Ua())},D.Ua=function(){Gn(this)},D.W=function(){try{return 2<Wn(this)?this.a.status:-1}catch(at){return-1}},D.$=function(){try{return this.a?this.a.responseText:""}catch(at){return""}},D.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Mn(e)}},D.ua=function(){return this.h},D.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(D=Jn.prototype).ha=8,D.v=1,D.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Le(this,this.c,t,void 0),r=this.l;if(this.O&&(r?it(r=nt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=or(this,n,e),un(i=nn(this.B),"RID",t),un(i,"CVER",22),this.A&&un(i,"X-HTTP-Session-Id",this.A),ir(this,i),this.i&&r&&Xn(i,this.i,r),Cn(this.b,n),this.Ia&&un(i,"TYPE","init"),this.da?(un(i,"$req",e),un(i,"SID","null"),n.U=!0,qe(n,i,null)):qe(n,i,e),this.v=2}}else 3==this.v&&(t?rr(this,t):0==this.g.length||An(this.b)||rr(this))},D.Aa=function(){if(this.j=null,cr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Se(U(this.Ta,this),t)}},D.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,_e(10),Zn(this),cr(this))},D.Sa=function(){null!=this.m&&(this.m=null,Zn(this),ar(this),_e(19))},D.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),_e(2)):(this.c.info("Failed to ping google.com"),_e(1))},(D=vr.prototype).ta=function(){},D.sa=function(){},D.ra=function(){},D.qa=function(){},D.Ja=function(){},gr.prototype.a=function(t,e){return new br(t,e)},B(br,Ht),br.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;_e(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=yr(t,null,t.fa),nr(t)},br.prototype.close=function(){$n(this.a)},br.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,er(this.a,e)}else this.l?((e={}).__data__=Yt(t),er(this.a,e)):er(this.a,t)},br.prototype.G=function(){this.a.f=null,delete this.f,$n(this.a),delete this.a,br.X.G.call(this)},B(wr,je),B(Ir,Pe),B(Er,vr),Er.prototype.ta=function(){Wt(this.a,"a")},Er.prototype.sa=function(t){Wt(this.a,new wr(t))},Er.prototype.ra=function(t){Wt(this.a,new Ir(t))},Er.prototype.qa=function(){Wt(this.a,"b")},gr.prototype.createWebChannel=gr.prototype.a,br.prototype.send=br.prototype.h,br.prototype.open=br.prototype.g,br.prototype.close=br.prototype.close,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,De.COMPLETE="complete",Ce.EventType=ke,ke.OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Ht.prototype.listen=Ht.prototype.va,Fn.prototype.listenOnce=Fn.prototype.wa,Fn.prototype.getLastError=Fn.prototype.Qa,Fn.prototype.getLastErrorCode=Fn.prototype.ua,Fn.prototype.getStatus=Fn.prototype.W,Fn.prototype.getResponseJson=Fn.prototype.Pa,Fn.prototype.getResponseText=Fn.prototype.$,Fn.prototype.send=Fn.prototype.ba;var Tr=Ae,_r=De,Or=ge,Sr=Ce,Ar=Fn,Dr=n("mrSG"),Nr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Nr.o=-1;var Cr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},xr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Dr.c)(e,t),e}(Error),kr=new O.b("@firebase/firestore");function jr(){return kr.logLevel}function Pr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=O.a.DEBUG){var r=e.map(Mr);kr.debug.apply(kr,Object(Dr.f)(["Firestore (8.4.2): "+t],r))}}function Rr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=O.a.ERROR){var r=e.map(Mr);kr.error.apply(kr,Object(Dr.f)(["Firestore (8.4.2): "+t],r))}}function Lr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(kr.logLevel<=O.a.WARN){var r=e.map(Mr);kr.warn.apply(kr,Object(Dr.f)(["Firestore (8.4.2): "+t],r))}}function Mr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Rd){return t}}function Fr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.4.2) INTERNAL ASSERTION FAILED: "+t;throw Rr(e),new Error(e)}function Ur(t,e){t||Fr()}function qr(t,e){return t}function Vr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Br=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Vr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Kr(t,e){return t<e?-1:t>e?1:0}function Qr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Gr(t){return t+"\0"}var zr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new xr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new xr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new xr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new xr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Kr(this.nanoseconds,t.nanoseconds):Kr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Hr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new zr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Wr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Yr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Jr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Fr(),void 0===n?n=t.length-e:n>t.length-e&&Fr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),$r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new xr(Cr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Jr),Zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ti=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Zr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new xr(Cr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new xr(Cr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new xr(Cr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new xr(Cr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Jr),ei=function(){function t(t){this.fields=t,t.sort(ti.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Qr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ni=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Kr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ni.EMPTY_BYTE_STRING=new ni("");var ri=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ii(t){if(Ur(!!t),"string"==typeof t){var e=0,n=ri.exec(t);if(Ur(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:oi(t.seconds),nanos:oi(t.nanos)}}function oi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function si(t){return"string"==typeof t?ni.fromBase64String(t):ni.fromUint8Array(t)}function ai(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ui(t){var e=t.mapValue.fields.__previous_value__;return ai(e)?ui(e):e}function ci(t){var e=ii(t.mapValue.fields.__local_write_time__.timestampValue);return new zr(e.seconds,e.nanos)}function hi(t){return null==t}function li(t){return 0===t&&1/t==-1/0}function fi(t){return"number"==typeof t&&Number.isInteger(t)&&!li(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var di=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t($r.fromString(e))},t.fromName=function(e){return new t($r.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===$r.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return $r.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new $r(e.slice()))},t}();function pi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ai(t)?4:10:Fr()}function yi(t,e){var n=pi(t);if(n!==pi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ci(t).isEqual(ci(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ii(t.timestampValue),r=ii(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return si(t.bytesValue).isEqual(si(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return oi(t.geoPointValue.latitude)===oi(e.geoPointValue.latitude)&&oi(t.geoPointValue.longitude)===oi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return oi(t.integerValue)===oi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=oi(t.doubleValue),r=oi(e.doubleValue);return n===r?li(n)===li(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Qr(t.arrayValue.values||[],e.arrayValue.values||[],yi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Wr(n)!==Wr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!yi(n[i],r[i])))return!1;return!0}(t,e);default:return Fr()}}function mi(t,e){return void 0!==(t.values||[]).find(function(t){return yi(t,e)})}function vi(t,e){var n=pi(t),r=pi(e);if(n!==r)return Kr(n,r);switch(n){case 0:return 0;case 1:return Kr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=oi(t.integerValue||t.doubleValue),r=oi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return gi(t.timestampValue,e.timestampValue);case 4:return gi(ci(t),ci(e));case 5:return Kr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=si(t),r=si(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Kr(n[i],r[i]);if(0!==o)return o}return Kr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Kr(oi(t.latitude),oi(e.latitude));return 0!==n?n:Kr(oi(t.longitude),oi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=vi(n[i],r[i]);if(o)return o}return Kr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Kr(r[s],o[s]);if(0!==a)return a;var u=vi(n[r[s]],i[o[s]]);if(0!==u)return u}return Kr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Fr()}}function gi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Kr(t,e);var n=ii(t),r=ii(e),i=Kr(n.seconds,r.seconds);return 0!==i?i:Kr(n.nanos,r.nanos)}function bi(t){return wi(t)}function wi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=ii(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?si(t.bytesValue).toBase64():"referenceValue"in t?di.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=wi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+wi(t.fields[o])}return e+"}"}(t.mapValue):Fr();var e}function Ii(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ei(t){return!!t&&"integerValue"in t}function Ti(t){return!!t&&"arrayValue"in t}function _i(t){return!!t&&"nullValue"in t}function Oi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Si(t){return!!t&&"mapValue"in t}var Ai=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(ti.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return yi(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===pi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Si(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)}),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(ti.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Si(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Di(t){var e=[];return Xr(t.fields||{},function(t,n){var r=new ti([t]);if(Si(n)){var i=Di(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new ei(e)}var Ni=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Hr.min(),Ai.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ai.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ai.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ai.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ai.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ci=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function xi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ci(t,e,n,r,i,o,s)}function ki(t){var e=qr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+bi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),hi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Gi(e.startAt)),e.endAt&&(n+="|ub:",n+=Gi(e.endAt)),e.h=n}return e.h}function ji(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Hi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!yi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xi(t.startAt,e.startAt)&&Xi(t.endAt,e.endAt)}function Pi(t){return di.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ri=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Dr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Li(t,n,r):"array-contains"===n?new qi(t,r):"in"===n?new Vi(t,r):"not-in"===n?new Bi(t,r):"array-contains-any"===n?new Ki(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Mi(t,n):new Fi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(vi(e,this.value)):null!==e&&pi(this.value)===pi(e)&&this.m(vi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Fr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Li=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=di.fromName(r.referenceValue),i}return Object(Dr.c)(e,t),e.prototype.matches=function(t){var e=di.comparator(t.key,this.key);return this.m(e)},e}(Ri),Mi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ui(0,n),r}return Object(Dr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ri),Fi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ui(0,n),r}return Object(Dr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ri);function Ui(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return di.fromName(t.referenceValue)})}var qi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Dr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Ti(e)&&mi(e.arrayValue,this.value)},e}(Ri),Vi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Dr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&mi(this.value.arrayValue,e)},e}(Ri),Bi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Dr.c)(e,t),e.prototype.matches=function(t){if(mi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!mi(this.value.arrayValue,e)},e}(Ri),Ki=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Dr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Ti(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return mi(e.value.arrayValue,t)})},e}(Ri),Qi=function(t,e){this.position=t,this.before=e};function Gi(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return bi(t)}).join(",")}var zi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Hi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Wi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?di.comparator(di.fromName(s.referenceValue),n.key):vi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Xi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!yi(t.position[n],e.position[n]))return!1;return!0}var Yi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Ji(t,e,n,r,i,o,s,a){return new Yi(t,e,n,r,i,o,s,a)}function $i(t){return new Yi(t)}function Zi(t){return!hi(t.limit)&&"F"===t.limitType}function to(t){return!hi(t.limit)&&"L"===t.limitType}function eo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function no(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function ro(t){return null!==t.collectionGroup}function io(t){var e=qr(t);if(null===e.p){e.p=[];var n=no(e),r=eo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new zi(n)),e.p.push(new zi(ti.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new zi(ti.keyField(),u))}}}return e.p}function oo(t){var e=qr(t);if(!e.T)if("F"===e.limitType)e.T=xi(e.path,e.collectionGroup,io(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=io(e);r<i.length;r++){var o=i[r];n.push(new zi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Qi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Qi(e.startAt.position,!e.startAt.before):null;e.T=xi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function so(t,e,n){return new Yi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ao(t,e){return ji(oo(t),oo(e))&&t.limitType===e.limitType}function uo(t){return ki(oo(t))+"|lt:"+t.limitType}function co(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+bi(e.value);var e}).join(", ")+"]"),hi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Gi(t.startAt)),t.endAt&&(e+=", endAt: "+Gi(t.endAt)),"Target("+e+")"}(oo(t))+"; limitType="+t.limitType+")"}function ho(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):di.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Wi(t.startAt,io(t),e)||t.endAt&&Wi(t.endAt,io(t),e))}(t,e)}function lo(t){return function(e,n){for(var r=!1,i=0,o=io(t);i<o.length;i++){var s=o[i],a=fo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function fo(t,e,n){var r=t.field.isKeyField()?di.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?vi(r,i):Fr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Fr()}}function po(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:li(e)?"-0":e}}function yo(t){return{integerValue:""+t}}function mo(t,e){return fi(e)?yo(e):po(t,e)}var vo=function(){this._=void 0};function go(t,e,n){return t instanceof Io?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Eo?To(t,e):t instanceof _o?Oo(t,e):function(t,e){var n=wo(t,e),r=Ao(n)+Ao(t.A);return Ei(n)&&Ei(t.A)?yo(r):po(t.R,r)}(t,e)}function bo(t,e,n){return t instanceof Eo?To(t,e):t instanceof _o?Oo(t,e):n}function wo(t,e){return t instanceof So?Ei(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Io=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e}(vo),Eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Dr.c)(e,t),e}(vo);function To(t,e){for(var n=Do(e),r=function(t){n.some(function(e){return yi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var _o=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Dr.c)(e,t),e}(vo);function Oo(t,e){for(var n=Do(e),r=function(t){n=n.filter(function(e){return!yi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var So=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Dr.c)(e,t),e}(vo);function Ao(t){return oi(t.integerValue||t.doubleValue)}function Do(t){return Ti(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var No=function(t,e){this.field=t,this.transform=e},Co=function(t,e){this.version=t,this.transformResults=e},xo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ko(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var jo=function(){};function Po(t,e,n){t instanceof Uo?function(t,e,n){var r=t.value.clone(),i=Bo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof qo?function(t,e,n){if(ko(t.precondition,e)){var r=Bo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Vo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ro(t,e,n){t instanceof Uo?function(t,e,n){if(ko(t.precondition,e)){var r=t.value.clone(),i=Ko(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Fo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof qo?function(t,e,n){if(ko(t.precondition,e)){var r=Ko(t.fieldTransforms,n,e),i=e.data;i.setAll(Vo(t)),i.setAll(r),e.convertToFoundDocument(Fo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){ko(t.precondition,e)&&e.convertToNoDocument(Hr.min())}(t,e)}function Lo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=wo(o.transform,s||null);null!=a&&(null==n&&(n=Ai.empty()),n.set(o.field,a))}return n||null}function Mo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Eo&&e instanceof Eo||t instanceof _o&&e instanceof _o?Qr(t.elements,e.elements,yi):t instanceof So&&e instanceof So?yi(t.A,e.A):t instanceof Io&&e instanceof Io}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Fo(t){return t.isFoundDocument()?t.version:Hr.min()}var Uo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Dr.c)(e,t),e}(jo),qo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Dr.c)(e,t),e}(jo);function Vo(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Bo(t,e,n){var r=new Map;Ur(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,bo(s,a,n[i]))}return r}function Ko(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,go(a,u,e))}return r}var Qo,Go,zo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Dr.c)(e,t),e}(jo),Ho=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Dr.c)(e,t),e}(jo),Wo=function(t){this.count=t};function Xo(t){switch(t){case Cr.OK:return Fr();case Cr.CANCELLED:case Cr.UNKNOWN:case Cr.DEADLINE_EXCEEDED:case Cr.RESOURCE_EXHAUSTED:case Cr.INTERNAL:case Cr.UNAVAILABLE:case Cr.UNAUTHENTICATED:return!1;case Cr.INVALID_ARGUMENT:case Cr.NOT_FOUND:case Cr.ALREADY_EXISTS:case Cr.PERMISSION_DENIED:case Cr.FAILED_PRECONDITION:case Cr.ABORTED:case Cr.OUT_OF_RANGE:case Cr.UNIMPLEMENTED:case Cr.DATA_LOSS:return!0;default:return Fr()}}function Yo(t){if(void 0===t)return Rr("GRPC error has no .code"),Cr.UNKNOWN;switch(t){case Qo.OK:return Cr.OK;case Qo.CANCELLED:return Cr.CANCELLED;case Qo.UNKNOWN:return Cr.UNKNOWN;case Qo.DEADLINE_EXCEEDED:return Cr.DEADLINE_EXCEEDED;case Qo.RESOURCE_EXHAUSTED:return Cr.RESOURCE_EXHAUSTED;case Qo.INTERNAL:return Cr.INTERNAL;case Qo.UNAVAILABLE:return Cr.UNAVAILABLE;case Qo.UNAUTHENTICATED:return Cr.UNAUTHENTICATED;case Qo.INVALID_ARGUMENT:return Cr.INVALID_ARGUMENT;case Qo.NOT_FOUND:return Cr.NOT_FOUND;case Qo.ALREADY_EXISTS:return Cr.ALREADY_EXISTS;case Qo.PERMISSION_DENIED:return Cr.PERMISSION_DENIED;case Qo.FAILED_PRECONDITION:return Cr.FAILED_PRECONDITION;case Qo.ABORTED:return Cr.ABORTED;case Qo.OUT_OF_RANGE:return Cr.OUT_OF_RANGE;case Qo.UNIMPLEMENTED:return Cr.UNIMPLEMENTED;case Qo.DATA_LOSS:return Cr.DATA_LOSS;default:return Fr()}}(Go=Qo||(Qo={}))[Go.OK=0]="OK",Go[Go.CANCELLED=1]="CANCELLED",Go[Go.UNKNOWN=2]="UNKNOWN",Go[Go.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Go[Go.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Go[Go.NOT_FOUND=5]="NOT_FOUND",Go[Go.ALREADY_EXISTS=6]="ALREADY_EXISTS",Go[Go.PERMISSION_DENIED=7]="PERMISSION_DENIED",Go[Go.UNAUTHENTICATED=16]="UNAUTHENTICATED",Go[Go.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Go[Go.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Go[Go.ABORTED=10]="ABORTED",Go[Go.OUT_OF_RANGE=11]="OUT_OF_RANGE",Go[Go.UNIMPLEMENTED=12]="UNIMPLEMENTED",Go[Go.INTERNAL=13]="INTERNAL",Go[Go.UNAVAILABLE=14]="UNAVAILABLE",Go[Go.DATA_LOSS=15]="DATA_LOSS";var Jo=function(){function t(t,e){this.comparator=t,this.root=e||Zo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Zo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Zo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new $o(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new $o(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new $o(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new $o(this.root,t,this.comparator,!0)},t}(),$o=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Zo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Fr();if(this.right.isRed())throw Fr();var t=this.left.check();if(t!==this.right.check())throw Fr();return t+(this.isRed()?0:1)},t}();Zo.EMPTY=null,Zo.RED=!0,Zo.BLACK=!1,Zo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Zo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ts=function(){function t(t){this.comparator=t,this.data=new Jo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new es(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new es(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),es=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ns=new Jo(di.comparator);function rs(){return ns}var is=new Jo(di.comparator);function os(){return is}var ss=new Jo(di.comparator);function as(){return ss}var us=new ts(di.comparator);function cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=us,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var hs=new ts(Kr);function ls(){return hs}var fs=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ds.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Hr.min(),r,ls(),rs(),cs())},t}(),ds=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ni.EMPTY_BYTE_STRING,n,cs(),cs(),cs())},t}(),ps=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ys=function(t,e){this.targetId=t,this.V=e},ms=function(t,e,n,r){void 0===n&&(n=ni.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},vs=function(){function t(){this.S=0,this.D=ws(),this.C=ni.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=cs(),e=cs(),n=cs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Fr()}}),new ds(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ws()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),gs=function(){function t(t){this.W=t,this.G=new Map,this.H=rs(),this.J=bs(),this.Y=new ts(Kr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Fr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Pi(i))if(0===n){var o=new di(i.path);this.tt(e,o,Ni.newNoDocument(o,Hr.min()))}else Ur(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Pi(o.target)){var s=new di(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Ni.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=cs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new fs(t,n,this.Y,this.H,r);return this.H=rs(),this.J=bs(),this.Y=new ts(Kr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new vs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ts(Kr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Pr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new vs),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function bs(){return new Jo(di.comparator)}function ws(){return new Jo(di.comparator)}var Is={asc:"ASCENDING",desc:"DESCENDING"},Es={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ts=function(t,e){this.databaseId=t,this.I=e};function _s(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Os(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ss(t,e){return _s(t,e.toTimestamp())}function As(t){return Ur(!!t),Hr.fromTimestamp(function(t){var e=ii(t);return new zr(e.seconds,e.nanos)}(t))}function Ds(t,e){return function(t){return new $r(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ns(t){var e=$r.fromString(t);return Ur(Zs(e)),e}function Cs(t,e){return Ds(t.databaseId,e.path)}function xs(t,e){var n=Ns(e);if(n.get(1)!==t.databaseId.projectId)throw new xr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new xr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new di(Rs(n))}function ks(t,e){return Ds(t.databaseId,e)}function js(t){var e=Ns(t);return 4===e.length?$r.emptyPath():Rs(e)}function Ps(t){return new $r(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Rs(t){return Ur(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ls(t,e,n){return{name:Cs(t,e),fields:n.toProto().mapValue.fields}}function Ms(t,e,n){var r=xs(t,e.name),i=As(e.updateTime),o=new Ai({mapValue:{fields:e.fields}}),s=Ni.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Fs(t,e){var n;if(e instanceof Uo)n={update:Ls(t,e.key,e.value)};else if(e instanceof zo)n={delete:Cs(t,e.key)};else if(e instanceof qo)n={update:Ls(t,e.key,e.data),updateMask:$s(e.fieldMask)};else{if(!(e instanceof Ho))return Fr();n={verify:Cs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Io)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Eo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _o)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof So)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Fr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ss(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Fr()}(t,e.precondition)),n}function Us(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?xo.updateTime(As(t.updateTime)):void 0!==t.exists?xo.exists(t.exists):xo.none()}(e.currentDocument):xo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Ur("REQUEST_TIME"===e.setToServerValue),n=new Io):"appendMissingElements"in e?n=new Eo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new _o(e.removeAllFromArray.values||[]):"increment"in e?n=new So(t,e.increment):Fr();var r=ti.fromServerFormat(e.fieldPath);return new No(r,n)}(t,e)}):[];if(e.update){var i=xs(t,e.update.name),o=new Ai({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ei((t.fieldPaths||[]).map(function(t){return ti.fromServerFormat(t)}))}(e.updateMask);return new qo(i,o,s,n,r)}return new Uo(i,o,n,r)}if(e.delete){var a=xs(t,e.delete);return new zo(a,n)}if(e.verify){var u=xs(t,e.verify);return new Ho(u,n)}return Fr()}function qs(t,e){return{documents:[ks(t,e.path)]}}function Vs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ks(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ks(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Oi(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NAN"}};if(_i(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Oi(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NAN"}};if(_i(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ws(t.field),op:Hs(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ws(t.field),direction:zs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||hi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Qs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Qs(e.endAt)),n}function Bs(t){var e=js(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Ur(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ks(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new zi(Xs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return hi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Gs(n.startAt));var h=null;return n.endAt&&(h=Gs(n.endAt)),Ji(e,i,a,s,u,"F",c,h)}function Ks(t){return t?void 0!==t.unaryFilter?[Js(t)]:void 0!==t.fieldFilter?[Ys(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Ks(t)}).reduce(function(t,e){return t.concat(e)}):Fr():[]}function Qs(t){return{before:t.before,values:t.position}}function Gs(t){return new Qi(t.values||[],!!t.before)}function zs(t){return Is[t]}function Hs(t){return Es[t]}function Ws(t){return{fieldPath:t.canonicalString()}}function Xs(t){return ti.fromServerFormat(t.fieldPath)}function Ys(t){return Ri.create(Xs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Fr()}}(t.fieldFilter.op),t.fieldFilter.value)}function Js(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Xs(t.unaryFilter.field);return Ri.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Xs(t.unaryFilter.field);return Ri.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Xs(t.unaryFilter.field);return Ri.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Xs(t.unaryFilter.field);return Ri.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Fr()}}function $s(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Zs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ta(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=na(e)),e=ea(t.get(n),e);return na(e)}function ea(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function na(t){return t+"\x01\x01"}function ra(t){var e=t.length;if(Ur(e>=2),2===e)return Ur("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),$r.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Fr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Fr()}o=s+2}return new $r(r)}var ia=function(t,e){this.seconds=t,this.nanoseconds=e},oa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};oa.store="owner",oa.key="owner";var sa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};sa.store="mutationQueues",sa.keyPath="userId";var aa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};aa.store="mutations",aa.keyPath="batchId",aa.userMutationsIndex="userMutationsIndex",aa.userMutationsKeyPath=["userId","batchId"];var ua=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ta(e)]},t.key=function(t,e,n){return[t,ta(e),n]},t}();ua.store="documentMutations",ua.PLACEHOLDER=new ua;var ca=function(t,e){this.path=t,this.readTime=e},ha=function(t,e){this.path=t,this.version=e},la=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};la.store="remoteDocuments",la.readTimeIndex="readTimeIndex",la.readTimeIndexPath="readTime",la.collectionReadTimeIndex="collectionReadTimeIndex",la.collectionReadTimeIndexPath=["parentPath","readTime"];var fa=function(t){this.byteSize=t};fa.store="remoteDocumentGlobal",fa.key="remoteDocumentGlobalKey";var da=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};da.store="targets",da.keyPath="targetId",da.queryTargetsIndexName="queryTargetsIndex",da.queryTargetsKeyPath=["canonicalId","targetId"];var pa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};pa.store="targetDocuments",pa.keyPath=["targetId","path"],pa.documentTargetsIndex="documentTargetsIndex",pa.documentTargetsKeyPath=["path","targetId"];var ya=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ya.key="targetGlobalKey",ya.store="targetGlobal";var ma=function(t,e){this.collectionId=t,this.parent=e};ma.store="collectionParents",ma.keyPath=["collectionId","parent"];var va=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};va.store="clientMetadata",va.keyPath="clientId";var ga=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ga.store="bundles",ga.keyPath="bundleId";var ba=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ba.store="namedQueries",ba.keyPath="name";var wa=Object(Dr.f)(Object(Dr.f)([],Object(Dr.f)(Object(Dr.f)([],Object(Dr.f)(Object(Dr.f)([],Object(Dr.f)(Object(Dr.f)([],[sa.store,aa.store,ua.store,la.store,da.store,oa.store,ya.store,pa.store]),[va.store])),[fa.store])),[ma.store])),[ga.store,ba.store]),Ia="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ea=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Ta=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},_a=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Fr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Oa=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ta,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Da(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ja(e.target.error);n.ft.reject(new Da(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Da(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Pr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ca(e)},t}(),Sa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(_.n)())&&Rr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Pr("SimpleDb","Removing database:",t),xa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(_.n)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Pr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Da(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new xr(Cr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Da(t,n))},i.onupgradeneeded=function(t){Pr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Pr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Dr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Dr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Oa.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),_a.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Pr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Aa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return xa(this.Pt.delete())},t}(),Da=function(t){function e(e,n){var r=this;return(r=t.call(this,Cr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Dr.c)(e,t),e}(xr);function Na(t){return"IndexedDbTransactionError"===t.name}var Ca=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Pr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Pr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),xa(n)},t.prototype.add=function(t){return Pr("SimpleDb","ADD",this.store.name,t,t),xa(this.store.add(t))},t.prototype.get=function(t){var e=this;return xa(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Pr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Pr("SimpleDb","DELETE",this.store.name,t),xa(this.store.delete(t))},t.prototype.count=function(){return Pr("SimpleDb","COUNT",this.store.name),xa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Pr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new _a(function(n,r){e.onerror=function(t){var e=ja(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new _a(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Aa(i),s=e(i.primaryKey,i.value,o);if(s instanceof _a){var a=s.catch(function(t){return o.done(),_a.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return _a.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function xa(t){return new _a(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=ja(t.target.error);n(e)}})}var ka=!1;function ja(t){var e=Sa._t(Object(_.n)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new xr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ka||(ka=!0,setTimeout(function(){throw r},0)),r}}return t}var Pa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Dr.c)(e,t),e}(Ea);function Ra(t,e){var n=qr(t);return Sa.It(n.Mt,e)}var La=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Po(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Ro(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Ro(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Hr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},cs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Qr(this.mutations,t.mutations,function(t,e){return Mo(t,e)})&&Qr(this.baseMutations,t.baseMutations,function(t,e){return Mo(t,e)})},t}(),Ma=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Ur(e.mutations.length===r.length);for(var i=as(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Fa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Hr.min()),void 0===o&&(o=Hr.min()),void 0===s&&(s=ni.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ua=function(t){this.Lt=t};function qa(t,e){if(e.document)return Ms(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=di.fromSegments(e.noDocument.path),r=Ga(e.noDocument.readTime),i=Ni.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=di.fromSegments(e.unknownDocument.path);return r=Ga(e.unknownDocument.version),Ni.newUnknownDocument(o,r)}return Fr()}function Va(t,e,n){var r=Ba(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Cs(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:_s(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new la(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Qa(e.version);return s=e.hasCommittedMutations,new la(null,new ca(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Qa(e.version);return new la(new ha(c,h),null,null,!0,r,i)}return Fr()}function Ba(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ka(t){var e=new zr(t[0],t[1]);return Hr.fromTimestamp(e)}function Qa(t){var e=t.toTimestamp();return new ia(e.seconds,e.nanoseconds)}function Ga(t){var e=new zr(t.seconds,t.nanoseconds);return Hr.fromTimestamp(e)}function za(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Us(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Us(t.Lt,e)}),o=zr.fromMillis(e.localWriteTimeMs);return new La(e.batchId,o,n,i)}function Ha(t){var e,n,r=Ga(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ga(t.lastLimboFreeSnapshotVersion):Hr.min();return void 0!==t.query.documents?(Ur(1===(n=t.query).documents.length),e=oo($i(js(n.documents[0])))):e=function(t){return oo(Bs(t))}(t.query),new Fa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ni.fromBase64String(t.resumeToken))}function Wa(t,e){var n,r=Qa(e.snapshotVersion),i=Qa(e.lastLimboFreeSnapshotVersion);n=Pi(e.target)?qs(t.Lt,e.target):Vs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new da(e.targetId,ki(e.target),r,o,e.sequenceNumber,i,n)}function Xa(t){var e=Bs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?so(e,e.limit,"L"):e}var Ya=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ja(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Ga(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Ja(t).put({bundleId:(n=e).id,createTime:Qa(As(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return $a(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Xa(e.bundledQuery),readTime:Ga(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return $a(t).put(function(t){return{name:t.name,readTime:Qa(As(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ja(t){return Ra(t,ga.store)}function $a(t){return Ra(t,ba.store)}var Za=function(){function t(){this.Bt=new tu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),_a.resolve()},t.prototype.getCollectionParents=function(t,e){return _a.resolve(this.Bt.getEntries(e))},t}(),tu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ts($r.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ts($r.comparator)).toArray()},t}(),eu=function(){function t(){this.qt=new tu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:ta(i)};return nu(t).put(o)}return _a.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Gr(e),""],!1,!0);return nu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ra(o.parent))}return n})},t}();function nu(t){return Ra(t,ma.store)}var ru={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},iu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function ou(t,e,n){var r=t.store(aa.store),i=t.store(ua.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Ur(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ua.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return _a.waitFor(o).next(function(){return c})}function su(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Fr();e=t.noDocument}return JSON.stringify(e).length}iu.DEFAULT_COLLECTION_PERCENTILE=10,iu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,iu.DEFAULT=new iu(41943040,iu.DEFAULT_COLLECTION_PERCENTILE,iu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),iu.DISABLED=new iu(-1,0,0);var au=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Ur(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return cu(t).Ot({index:aa.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=hu(t),s=cu(t);return s.add({}).next(function(a){Ur("number"==typeof a);for(var u=new La(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Fs(t.Lt,e)}),i=n.mutations.map(function(e){return Fs(t.Lt,e)});return new aa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ts(function(t,e){return Kr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=ua.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ua.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),_a.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return cu(t).get(e).next(function(t){return t?(Ur(t.userId===n.userId),za(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?_a.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return cu(t).Ot({index:aa.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Ur(e.batchId>=r),o=za(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return cu(t).Ot({index:aa.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return cu(t).Nt(aa.userMutationsIndex,n).next(function(t){return t.map(function(t){return za(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ua.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return hu(t).Ot({range:i},function(r,i,s){var a=r[0],u=r[2],c=ra(r[1]);if(a===n.userId&&e.path.isEqual(c))return cu(t).get(u).next(function(t){if(!t)throw Fr();Ur(t.userId===n.userId),o.push(za(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ts(Kr),i=[];return e.forEach(function(e){var o=ua.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=hu(t).Ot({range:s},function(t,i,o){var s=t[0],a=t[2],u=ra(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),_a.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ua.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ts(Kr);return hu(t).Ot({range:s},function(t,e,o){var s=t[0],u=t[2],c=ra(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(cu(t).get(e).next(function(t){if(null===t)throw Fr();Ur(t.userId===n.userId),r.push(za(n.R,t))}))}),_a.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return ou(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),_a.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return _a.resolve();var r=IDBKeyRange.lowerBound(ua.prefixForUser(e.userId)),i=[];return hu(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=ra(t[1]);i.push(o)}else r.done()}).next(function(){Ur(0===i.length)})})},t.prototype.containsKey=function(t,e){return uu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return lu(t).get(this.userId).next(function(t){return t||new sa(e.userId,-1,"")})},t}();function uu(t,e,n){var r=ua.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return hu(t).Ot({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function cu(t){return Ra(t,aa.store)}function hu(t){return Ra(t,ua.store)}function lu(t){return Ra(t,sa.store)}var fu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),du=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new fu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Hr.fromTimestamp(new zr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return pu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Ur(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return pu(t).Ot(function(s,a){var u=Ha(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return _a.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return pu(t).Ot(function(t,n){var r=Ha(n);e(r)})},t.prototype.Xt=function(t){return yu(t).get(ya.key).next(function(t){return Ur(null!==t),t})},t.prototype.Zt=function(t,e){return yu(t).put(ya.key,e)},t.prototype.te=function(t,e){return pu(t).put(Wa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=ki(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return pu(t).Ot({range:r,index:da.queryTargetsIndexName},function(t,n,r){var o=Ha(n);ji(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=mu(t);return e.forEach(function(e){var s=ta(e.path);i.push(o.put(new pa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),_a.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=mu(t);return _a.forEach(e,function(e){var o=ta(e.path);return _a.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=mu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=mu(t),i=cs();return r.Ot({range:n,kt:!0},function(t,e,n){var r=ra(t[1]),o=new di(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ta(e.path),r=IDBKeyRange.bound([n],[Gr(n)],!1,!0),i=0;return mu(t).Ot({index:pa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return pu(t).get(e).next(function(t){return t?Ha(t):null})},t}();function pu(t){return Ra(t,da.store)}function yu(t){return Ra(t,ya.store)}function mu(t){return Ra(t,pa.store)}function vu(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){if(t.code!==Cr.FAILED_PRECONDITION||t.message!==Ia)throw t;return Pr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function gu(t,e){var n=t[1],r=e[1],i=Kr(t[0],e[0]);return 0===i?Kr(n,r):i}var bu=function(){function t(t){this.ne=t,this.buffer=new ts(gu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();gu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),wu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Pr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Dr.b)(e,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Na(e=n.sent())?(Pr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,vu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Iu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return _a.resolve(Nr.o);var r=new bu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; disabled"),_a.resolve(ru)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),ru):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Pr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),jr()<=O.a.DEBUG&&Pr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),_a.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Eu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Iu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Tu(t,n)},t.prototype.removeReference=function(t,e,n){return Tu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Tu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return lu(t).$t(function(r){return uu(t,r,e).next(function(t){return t&&(n=!0),_a.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),mu(t).delete([0,ta(s.path)])})});i.push(u)}}).next(function(){return _a.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Tu(t,e)},t.prototype.we=function(t,e){var n,r=mu(t),i=Nr.o;return r.Ot({index:pa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Nr.o&&e(new di(ra(n)),i),i=s,n=o):i=Nr.o}).next(function(){i!==Nr.o&&e(new di(ra(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Tu(t,e){return mu(t).put(function(t,e){return new pa(0,ta(t.path),e)}(e,t.currentSequenceNumber))}var _u=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Xr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Yr(this.inner)},t}(),Ou=function(){function t(){this.changes=new _u(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Hr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Ni.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?_a.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Su=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Nu(t).put(Cu(e),n)},t.prototype.removeEntry=function(t,e){var n=Nu(t),r=Cu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Nu(t).get(Cu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Nu(t).get(Cu(e)).next(function(t){return{document:n.ye(e,t),size:su(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=rs();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=rs(),i=new Jo(di.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,su(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return _a.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Nu(t).Ot({range:r},function(t,e,r){for(var s=di.fromSegments(t);o&&di.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=rs(),o=e.path.length+1,s={};if(n.isEqual(Hr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ba(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=la.collectionReadTimeIndex}return Nu(t).Ot(s,function(t,n,s){if(t.length===o){var a=qa(r.R,n);e.path.isPrefixOf(a.key.path)?ho(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Au(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Du(t).get(fa.key).next(function(t){return Ur(!!t),t})},t.prototype.me=function(t,e){return Du(t).put(fa.key,e)},t.prototype.ye=function(t,e){if(e){var n=qa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Hr.min()))return n}return Ni.newInvalidDocument(t)},t}(),Au=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new _u(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Dr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ts(function(t,e){return Kr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Va(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=su(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Va(e.Ie.R,Ni.newNoDocument(o,Hr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),_a.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Ou);function Du(t){return Ra(t,fa.store)}function Nu(t){return Ra(t,la.store)}function Cu(t){return t.path.toArray()}var xu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Ur(n<r&&n>=0&&r<=11);var o=new Oa("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(oa.store)}(t),function(t){t.createObjectStore(sa.store,{keyPath:sa.keyPath}),t.createObjectStore(aa.store,{keyPath:aa.keyPath,autoIncrement:!0}).createIndex(aa.userMutationsIndex,aa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ua.store)}(t),ku(t),function(t){t.createObjectStore(la.store)}(t));var s=_a.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(pa.store),t.deleteObjectStore(da.store),t.deleteObjectStore(ya.store)}(t),ku(t)),s=s.next(function(){return function(t){var e=t.store(ya.store),n=new ya(0,0,Hr.min().toTimestamp(),0);return e.put(ya.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(aa.store).Nt().next(function(n){t.deleteObjectStore(aa.store),t.createObjectStore(aa.store,{keyPath:aa.keyPath,autoIncrement:!0}).createIndex(aa.userMutationsIndex,aa.userMutationsKeyPath,{unique:!0});var r=e.store(aa.store),i=n.map(function(t){return r.put(t)});return _a.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(va.store,{keyPath:va.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(fa.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(la.store);e.createIndex(la.readTimeIndex,la.readTimeIndexPath,{unique:!1}),e.createIndex(la.collectionReadTimeIndex,la.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(ga.store,{keyPath:ga.keyPath})}(t),function(t){t.createObjectStore(ba.store,{keyPath:ba.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(la.store).Ot(function(t,n){e+=su(n)}).next(function(){var n=new fa(e);return t.store(fa.store).put(fa.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(sa.store),r=t.store(aa.store);return n.Nt().next(function(n){return _a.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(aa.userMutationsIndex,i).next(function(r){return _a.forEach(r,function(r){Ur(r.userId===n.userId);var i=za(e.R,r);return ou(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(pa.store),n=t.store(la.store);return t.store(ya.store).get(ya.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new $r(n),s=function(t){return[0,ta(t)]}(o);r.push(e.get(s).next(function(n){return n?_a.resolve():function(n){return e.put(new pa(0,ta(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return _a.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ma.store,{keyPath:ma.keyPath});var n=e.store(ma.store),r=new tu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ta(i)})}};return e.store(la.store).Ot({kt:!0},function(t,e){var n=new $r(t);return i(n.popLast())}).next(function(){return e.store(ua.store).Ot({kt:!0},function(t,e){var n=ra(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(da.store);return n.Ot(function(t,r){var i=Ha(r),o=Wa(e.R,i);return n.put(o)})},t}();function ku(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath}).createIndex(pa.documentTargetsIndex,pa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(da.store,{keyPath:da.keyPath}).createIndex(da.queryTargetsIndexName,da.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ya.store)}var ju="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Pu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new xr(Cr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Eu(this,i),this.Le=n+"main",this.R=new Ua(u),this.Be=new Sa(this.Le,11,new xu(this.R)),this.qe=new du(this.referenceDelegate,this.R),this.Ut=new eu,this.Ue=function(t,e){return new Su(t,e)}(this.R,this.Ut),this.Qe=new Ya,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Rr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new xr(Cr.FAILED_PRECONDITION,ju);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Nr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Dr.b)(e,void 0,void 0,function(){return Object(Dr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Dr.b)(e,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Dr.b)(e,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Lu(e).put(new va(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Na(e))return Pr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Pr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Ru(t).get(oa.key).next(function(t){return _a.resolve(e.tn(t))})},t.prototype.en=function(t){return Lu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ra(t,va.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return _a.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?_a.resolve(!0):Ru(t).get(oa.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new xr(Cr.FAILED_PRECONDITION,ju);return!1}}return!(!e.networkEnabled||!e.inForeground)||Lu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Pr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t=this;return Object(Dr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[oa.store,va.store],function(e){var n=new Pa(e,Nr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Lu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return au.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Pr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",wa,function(o){return r=new Pa(o,i.Ne?i.Ne.next():Nr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Rr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new xr(Cr.FAILED_PRECONDITION,Ia);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Ru(t).get(oa.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new xr(Cr.FAILED_PRECONDITION,ju)})},t.prototype.Ze=function(t){var e=new oa(this.clientId,this.allowTabSynchronization,Date.now());return Ru(t).put(oa.key,e)},t.yt=function(){return Sa.yt()},t.prototype.Xe=function(t){var e=this,n=Ru(t);return n.get(oa.key).next(function(t){return e.tn(t)?(Pr("IndexedDbPersistence","Releasing primary lease."),n.delete(oa.key)):_a.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Rr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Pr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Rr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Rr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ru(t){return Ra(t,oa.store)}function Lu(t){return Ra(t,va.store)}function Mu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Fu=function(t,e){this.progress=t,this.wn=e},Uu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return di.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):ro(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new di(e)).next(function(t){var e=os();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=os();return this.Ut.getCollectionParents(t,i).next(function(s){return _a.forEach(s,function(s){var a=function(t,e){return new Yi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Ni.newInvalidDocument(c),r=r.insert(c,h)),Ro(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){ho(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=cs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof qo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),qu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=cs(),i=cs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Vu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Hr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(Zi(e)||to(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(jr()<=O.a.DEBUG&&Pr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),co(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ts(lo(t));return e.forEach(function(e,r){ho(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return jr()<=O.a.DEBUG&&Pr("QueryEngine","Using full collection scan to execute query:",co(e)),this.Sn.getDocumentsMatchingQuery(t,e,Hr.min())},t}(),Bu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Jo(Kr),this.kn=new _u(function(t){return ki(t)},ji),this.On=Hr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Uu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Ku(t,e,n,r){return new Bu(t,e,n,r)}function Qu(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Dr.d)(this,function(s){switch(s.label){case 0:return n=qr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Uu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=cs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,m=p.mutations;y<m.length;y++)s=s.add(m[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Gu(t,e){var n=qr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=_a.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Ur(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function zu(t){var e=qr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Hu(t,e){var n=qr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Ur(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=rs();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Wu(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Hr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return _a.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Wu(t,e,n,r,i){var o=cs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=rs();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Hr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Pr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Xu(t,e){var n=qr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Yu(t,e){var n=qr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?_a.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Fa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Ju(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:r=qr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Na(s=a.sent()))throw s;return Pr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function $u(t,e,n){var r=qr(t),i=Hr.min(),o=cs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=qr(t),i=r.kn.get(n);return void 0!==i?_a.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,oo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Hr.min(),n?o:cs())}).next(function(t){return{documents:t,Bn:o}})})}function Zu(t,e){var n=qr(t),r=qr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function tc(t){var e=qr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=qr(t),i=rs(),o=Ba(n),s=Nu(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:la.readTimeIndex,range:a},function(t,e){var n=qa(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Ka(o)}})}(e.$n,t,e.On)}).then(function(t){var n=t.wn;return e.On=t.readTime,n})}function ec(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){return[2,(e=qr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Nu(t),n=Hr.min();return e.Ot({index:la.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Ka(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.On=t})]})})}function nc(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Dr.d)(this,function(p){switch(p.label){case 0:for(i=qr(t),o=cs(),s=rs(),a=as(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Yu(i,function(t){return oo($i($r.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Wu(t,f,s,Hr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function rc(t,e,n){return void 0===n&&(n=cs()),Object(Dr.b)(this,void 0,void 0,function(){var r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return[4,Yu(t,oo(Xa(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=qr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=As(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(ni.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var ic=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return _a.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:As(n.createTime)}),_a.resolve()},t.prototype.getNamedQuery=function(t,e){return _a.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Xa(t.bundledQuery),readTime:As(t.readTime)}}(e)),_a.resolve()},t}(),oc=function(){function t(){this.Wn=new ts(sc.Gn),this.zn=new ts(sc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new sc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new sc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new di(new $r([])),r=new sc(n,t),i=new sc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new di(new $r([])),n=new sc(e,t),r=new sc(e,t+1),i=cs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new sc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),sc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return di.comparator(t.key,e.key)||Kr(t.ns,e.ns)},t.Hn=function(t,e){return Kr(t.ns,e.ns)||di.comparator(t.key,e.key)},t}(),ac=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ts(sc.Gn)}return t.prototype.checkEmpty=function(t){return _a.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new La(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new sc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return _a.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return _a.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return _a.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return _a.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return _a.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new sc(e,0),i=new sc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),_a.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ts(Kr);return e.forEach(function(t){var e=new sc(t,0),i=new sc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),_a.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;di.isDocumentKey(i)||(i=i.child(""));var o=new sc(new di(i),0),s=new ts(Kr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),_a.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Ur(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return _a.forEach(e.mutations,function(i){var o=new sc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new sc(e,0),r=this.rs.firstAfterOrEqual(n);return _a.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return _a.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),uc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Jo(di.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return _a.resolve(n?n.document.clone():Ni.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=rs();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Ni.newInvalidDocument(t))}),_a.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=rs(),i=new di(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||ho(e,u)&&(r=r.insert(u.key,u.clone()))}return _a.resolve(r)},t.prototype.fs=function(t,e){return _a.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new cc(this)},t.prototype.getSize=function(t){return _a.resolve(this.size)},t}(),cc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Dr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),_a.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Ou),hc=function(){function t(t){this.persistence=t,this.ds=new _u(function(t){return ki(t)},ji),this.lastRemoteSnapshotVersion=Hr.min(),this.highestTargetId=0,this.ws=0,this._s=new oc,this.targetCount=0,this.ys=fu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),_a.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return _a.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return _a.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),_a.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),_a.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new fu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,_a.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),_a.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,_a.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),_a.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return _a.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return _a.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),_a.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),_a.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),_a.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return _a.resolve(n)},t.prototype.containsKey=function(t,e){return _a.resolve(this._s.containsKey(e))},t}(),lc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Nr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new hc(this),this.Ut=new Za,this.Ue=function(t,e){return new uc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Ua(e),this.Qe=new ic(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new ac(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Pr("MemoryPersistence","Starting transaction:",t);var i=new fc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return _a.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),fc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Dr.c)(e,t),e}(Ea),dc=function(){function t(t){this.persistence=t,this.As=new oc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Fr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),_a.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),_a.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),_a.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _a.forEach(this.vs,function(r){var i=di.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return _a.or([function(){return _a.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),pc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function yc(t,e){return"firestore_clients_"+t+"_"+e}function mc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function vc(t,e){return"firestore_targets_"+t+"_"+e}pc.UNAUTHENTICATED=new pc(null),pc.GOOGLE_CREDENTIALS=new pc("google-credentials-uid"),pc.FIRST_PARTY=new pc("first-party-uid");var gc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new xr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Rr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),bc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new xr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Rr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),wc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ls(),s=0;i&&s<r.activeTargetIds.length;++s)i=fi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Rr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Ic=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Rr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Ec=function(){function t(){this.activeTargetIds=ls()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Tc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Jo(Kr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=yc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Ec),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Dr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(yc(this.persistenceKey,r)))&&(o=wc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("unload",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(vc(this.persistenceKey,t));if(n){var r=bc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(vc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Pr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Pr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Pr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Pr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void Rr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Dr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Dr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Nr.o;if(null!=t)try{var n=JSON.parse(t);Ur("number"==typeof n),e=n}catch(t){Rr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Nr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new gc(this.currentUser,t,e,n),i=mc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=mc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=vc(this.persistenceKey,t),i=new bc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return wc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return gc.Vs(new pc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return bc.Vs(r,e)},t.prototype.js=function(t){return Ic.Vs(t)},t.prototype.ii=function(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Pr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ls();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),_c=function(){function t(){this.li=new Ec,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Ec,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Oc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Sc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Pr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Pr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Ac={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Dc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Nc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(Dr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Ar;s.listenOnce(_r.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Tr.NO_ERROR:var e=s.getResponseJson();Pr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Tr.TIMEOUT:Pr("Connection",'RPC "'+t+'" timed out'),o(new xr(Cr.DEADLINE_EXCEEDED,"Request time out"));break;case Tr.HTTP_ERROR:var n=s.getStatus();if(Pr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Cr).indexOf(e)>=0?e:Cr.UNKNOWN}(r.status);o(new xr(a,r.message))}else o(new xr(Cr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new xr(Cr.UNAVAILABLE,"Connection failed."));break;default:Fr()}}finally{Pr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new gr,i=we(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(o.initMessageHeaders,e),Object(_.u)()||Object(_.x)()||Object(_.r)()||Object(_.t)()||Object(_.y)()||Object(_.q)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Pr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Dc({Ei:function(t){c?Pr("Connection","Not sending because WebChannel is closed:",t):(u||(Pr("Connection","Opening WebChannel transport."),a.open(),u=!0),Pr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Sr.EventType.OPEN,function(){c||Pr("Connection","WebChannel transport opened.")}),l(a,Sr.EventType.CLOSE,function(){c||(c=!0,Pr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Sr.EventType.ERROR,function(t){c||(c=!0,Lr("Connection","WebChannel transport errored:",t),h.Vi(new xr(Cr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Sr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Ur(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Pr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Qo[t];if(void 0!==e)return Yo(e)}(i),s=r.message;void 0===o&&(o=Cr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new xr(o,s)),a.close()}else Pr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Or.STAT_EVENT,function(t){10===t.stat?Pr("Connection","Detected buffering proxy"):11===t.stat&&Pr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Pr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Pr("RestConnection","Received: ",t),t},function(e){throw Lr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.4.2",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Ac[t]},t}());function Cc(){return"undefined"!=typeof window?window:null}function xc(){return"undefined"!=typeof document?document:null}function kc(t){return new Ts(t,!0)}var jc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Pr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Pc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new jc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Cr.RESOURCE_EXHAUSTED?(Rr(e.toString()),Rr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Cr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new xr(Cr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Dr.b)(t,void 0,void 0,function(){return Object(Dr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Pr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Pr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Rc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Dr.c)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Fr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Ur(void 0===e||"string"==typeof e),ni.fromBase64String(e||"")):(Ur(void 0===e||e instanceof Uint8Array),ni.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Cr.UNKNOWN:Yo(t.code);return new xr(e,t.message||"")}(a);n=new ms(r,i,o,s||null)}else if("documentChange"in e){i=xs(t,(r=e.documentChange).document.name),o=As(r.document.updateTime);var a=new Ai({mapValue:{fields:r.document.fields}}),u=(s=Ni.newFoundDocument(i,o,a),r.targetIds||[]);n=new ps(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=xs(t,(r=e.documentDelete).document),o=r.readTime?As(r.readTime):Hr.min(),a=Ni.newNoDocument(i,o),n=new ps([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=xs(t,(r=e.documentRemove).document),n=new ps([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Fr();var c=e.filter;i=new Wo(r=c.count||0),n=new ys(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Hr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Hr.min():e.readTime?As(e.readTime):Hr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Ps(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Pi(r)?{documents:qs(t,r)}:{query:Vs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Os(t,e.resumeToken):e.snapshotVersion.compareTo(Hr.min())>0&&(n.readTime=_s(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Fr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Ps(this.R),e.removeTarget=t,this.cr(e)},e}(Pc),Lc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Dr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Ur(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Ur(void 0!==e),t.map(function(t){return function(t,e){var n=As(t.updateTime?t.updateTime:e);return n.isEqual(Hr.min())&&(n=As(e)),new Co(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=As(t.commitTime);return this.listener.Tr(n,e)}return Ur(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Ps(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Fs(e.R,t)})};this.cr(n)},e}(Pc),Mc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Dr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new xr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Cr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new xr(Cr.UNKNOWN,t.toString())})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Cr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new xr(Cr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Fc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Rr(e),this.Vr=!1):Pr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Uc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Dr.b)(o,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return Wc(this)?(Pr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return(e=qr(t)).$r.add(4),[4,Vc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,qc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Fc(n,r)};function qc(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:if(!Wc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Vc(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Bc(t,e){var n=qr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Hc(n)?zc(n):ch(n).er()&&Qc(n,e))}function Kc(t,e){var n=qr(t),r=ch(n);n.Or.delete(e),r.er()&&Gc(n,e),0===n.Or.size&&(r.er()?r.ir():Wc(n)&&n.Br.set("Unknown"))}function Qc(t,e){t.qr.U(e.targetId),ch(t).mr(e)}function Gc(t,e){t.qr.U(e),ch(t).yr(e)}function zc(t){t.qr=new gs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),ch(t).start(),t.Br.Sr()}function Hc(t){return Wc(t)&&!ch(t).tr()&&t.Or.size>0}function Wc(t){return 0===qr(t).$r.size}function Xc(t){t.qr=void 0}function Yc(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){return t.Or.forEach(function(e,n){Qc(t,e)}),[2]})})}function Jc(t,e){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(n){return Xc(t),Hc(t)?(t.Br.Nr(e),zc(t)):t.Br.set("Unknown"),[2]})})}function $c(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o;return Object(Dr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ms&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Dr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Pr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Zc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof ps?t.qr.X(e):e instanceof ys?t.qr.rt(e):t.qr.et(e),n.isEqual(Hr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,zu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(ni.EMPTY_BYTE_STRING,n.snapshotVersion)),Gc(t,e);var r=new Fa(n.target,e,1,n.sequenceNumber);Qc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Pr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Zc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Zc(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r=this;return Object(Dr.d)(this,function(i){switch(i.label){case 0:if(!Na(e))throw e;return t.$r.add(1),[4,Vc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return zu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Dr.b)(r,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return Pr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,qc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function th(t,e){return e().catch(function(n){return Zc(t,n,e)})}function eh(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Dr.d)(this,function(s){switch(s.label){case 0:e=qr(t),n=hh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Wc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Xu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=hh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Zc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return nh(e)&&rh(e),[2]}})})}function nh(t){return Wc(t)&&!hh(t).tr()&&t.kr.length>0}function rh(t){hh(t).start()}function ih(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){return hh(t).Ar(),[2]})})}function oh(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n,r;return Object(Dr.d)(this,function(i){for(e=hh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function sh(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ma.from(r,e,n),[4,th(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,eh(t)];case 2:return o.sent(),[2]}})})}function ah(t,e){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e&&hh(t).pr?[4,function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return Xo(r=e.code)&&r!==Cr.ABORTED?(n=t.kr.shift(),hh(t).sr(),[4,th(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,eh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return nh(t)&&rh(t),[2]}})})}function uh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return n=qr(t),e?(n.$r.delete(2),[4,qc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Vc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function ch(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=qr(t);return r.br(),new Rc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Yc.bind(null,t),Ri:Jc.bind(null,t),_r:$c.bind(null,t)}),t.Mr.push(function(n){return Object(Dr.b)(e,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Hc(t)?zc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Xc(t),e.label=3;case 3:return[2]}})})})),t.Ur}function hh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=qr(t);return r.br(),new Lc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ih.bind(null,t),Ri:ah.bind(null,t),Ir:oh.bind(null,t),Tr:sh.bind(null,t)}),t.Mr.push(function(n){return Object(Dr.b)(e,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,eh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Pr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var lh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ta,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xr(Cr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function fh(t,e){if(Rr("AsyncQueue",e+": "+t),Na(t))return new xr(Cr.UNAVAILABLE,e+": "+t);throw t}var dh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||di.comparator(e.key,n.key)}:function(t,e){return di.comparator(t.key,e.key)},this.keyedMap=os(),this.sortedSet=new Jo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),ph=function(){function t(){this.Kr=new Jo(di.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Fr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),yh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,dh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ao(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mh=function(){this.Wr=void 0,this.listeners=[]},vh=function(){this.queries=new _u(function(t){return uo(t)},ao),this.onlineState="Unknown",this.Gr=new Set};function gh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Dr.d)(this,function(c){switch(c.label){case 0:if(n=qr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new mh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=fh(a,"Initialization of query '"+co(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Eh(n),[2]}})})}function bh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Dr.d)(this,function(a){return n=qr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function wh(t,e){for(var n=qr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Eh(n)}function Ih(t,e,n){var r=qr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Eh(t){t.Gr.forEach(function(t){t.next()})}var Th=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new yh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=yh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),_h=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Oh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return xs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ms(this.R,t.document,!1):Ni.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return As(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Oh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||cs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return[4,nc(this.localStore,new Oh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,rc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Fu(Object.assign({},this.progress),t))]}})})}}();var Sh=function(t){this.key=t},Ah=function(t){this.key=t},Dh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=cs(),this.mutatedKeys=cs(),this.lo=lo(t),this.fo=new dh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new ph,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Zi(this.query)&&i.size===this.query.limit?i.last():null,c=to(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=ho(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Zi(this.query)||to(this.query))for(;s.size>this.query.limit;){var h=Zi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new yh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ph,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=cs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Ah(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Sh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=cs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return yh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Nh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ch=function(t){this.key=t,this.bo=!1},xh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new _u(function(t){return uo(t)},ao),this.Vo=new Map,this.So=new Set,this.Do=new Jo(di.comparator),this.Co=new Map,this.No=new oc,this.xo={},this.Fo=new Map,this.ko=fu.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function kh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:return n=al(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Yu(n.localStore,oo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,jh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Bc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function jh(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Dr.d)(this,function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,$u(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(zh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,$u(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Dh(e,i.Bn),s=o._o(i.documents),a=ds.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),zh(t,n,u.To),c=new Nh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Ph(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return n=qr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!ao(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Ju(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Kc(n.remoteStore,r.targetId),Qh(n,r.targetId)}).catch(vu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Qh(n,r.targetId),[4,Ju(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Rh(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:r=ul(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=qr(t),i=zr.now(),o=e.reduce(function(t,e){return t.add(e.key)},cs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Lo(c,n.get(c.key));null!=h&&s.push(new qo(c.key,h,Di(h.toProto().mapValue),xo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Jo(Kr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Xh(r,i.changes)];case 3:return a.sent(),[4,eh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=fh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Lh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:n=qr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Hu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Ur(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Ur(r.bo):t.removedDocuments.size>0&&(Ur(r.bo),r.bo=!1))}),[4,Xh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,vu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Mh(t,e,n){var r=qr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=qr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Eh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Fh(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Dr.d)(this,function(c){switch(c.label){case 0:return(r=qr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Jo(di.comparator)).insert(o,Ni.newNoDocument(o,Hr.min())),a=cs().add(o),u=new fs(Hr.min(),new Map,new ts(Kr),s,a),[4,Lh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Wh(r),[3,4];case 2:return[4,Ju(r.localStore,e,!1).then(function(){return Qh(r,e,n)}).catch(vu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Uh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:n=qr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Gu(n.localStore,e)];case 2:return i=o.sent(),Kh(n,r,null),Bh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Xh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,vu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function qh(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:r=qr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=qr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Ur(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Kh(r,e,n),Bh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Xh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,vu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Vh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:Wc((n=qr(t)).remoteStore)||Pr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=qr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=fh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Bh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Kh(t,e,n){var r=qr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Qh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Gh(t,e)})}function Gh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Kc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Wh(t))}function zh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Sh?(t.No.addReference(o.key,e),Hh(t,o)):o instanceof Ah?(Pr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Gh(t,o.key)):Fr()}}function Hh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Pr("SyncEngine","New document in limbo: "+n),t.So.add(r),Wh(t))}function Wh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new di($r.fromString(e)),r=t.ko.next();t.Co.set(r,new Ch(n)),t.Do=t.Do.insert(n,r),Bc(t.remoteStore,new Fa(oo($i(n.path)),r,2,Nr.o))}}function Xh(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:return r=qr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.$o(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=qu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Dr.d)(this,function(h){switch(h.label){case 0:n=qr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return _a.forEach(e,function(e){return _a.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return _a.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Na(r=h.sent()))throw r;return Pr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Yh(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return(n=qr(t)).currentUser.isEqual(e)?[3,3]:(Pr("SyncEngine","User change. New user:",e.toKey()),[4,Qu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new xr(Cr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Xh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Jh(t,e){var n=qr(t),r=n.Co.get(e);if(r&&r.bo)return cs().add(r.key);var i=cs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function $h(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return[4,$u((n=qr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&zh(n,e.targetId,i.To),i)]}})})}function Zh(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){return[2,tc((e=qr(t)).localStore).then(function(t){return Xh(e,t)})]})})}function tl(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o;return Object(Dr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=qr(t),r=qr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):_a.resolve(null)})})}((i=qr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,eh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Kh(i,e,r||null),Bh(i,e),function(t,e){qr(qr(t)._n).Gt(e)}(i.localStore,e)):Fr(),s.label=4;case 4:return[4,Xh(i,o)];case 5:return s.sent(),[3,7];case 6:Pr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function el(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Dr.d)(this,function(c){switch(c.label){case 0:return al(n=qr(t)),ul(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,nl(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,uh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Bc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return Qh(n,e),Ju(n.localStore,e,!0)}),Kc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,nl(n,a)];case 5:return c.sent(),function(t){var e=qr(t);e.Co.forEach(function(t,n){Kc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Jo(di.comparator)}(n),n.Oo=!1,[4,uh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function nl(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Dr.d)(this,function(y){switch(y.label){case 0:n=qr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Yu(n.localStore,oo(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,$h(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Zu(n.localStore,a)];case 8:return p=y.sent(),[4,Yu(n.localStore,p)];case 9:return u=y.sent(),[4,jh(n,rl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function rl(t){return Ji(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function il(t){var e=qr(t);return qr(qr(e.localStore).persistence).fn()}function ol(t,e,n,r){return Object(Dr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Dr.d)(this,function(a){switch(a.label){case 0:return(i=qr(t)).Oo?(Pr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,tc(i.localStore)];case 3:return o=a.sent(),s=fs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Xh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Ju(i.localStore,e,!0)];case 6:return a.sent(),Qh(i,e,r),[3,8];case 7:Fr(),a.label=8;case 8:return[2]}})})}function sl(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Dr.d)(this,function(f){switch(f.label){case 0:if(!(r=al(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Pr("SyncEngine","Adding an already active target "+s),[3,5]):[4,Zu(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Yu(r.localStore,a)];case 3:return u=f.sent(),[4,jh(r,rl(a),u.targetId,!1)];case 4:f.sent(),Bc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Ju(r.localStore,t,!1).then(function(){Kc(r.remoteStore,t),Qh(r,t)}).catch(vu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function al(t){var e=qr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Jh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Fh.bind(null,e),e.vo._r=wh.bind(null,e.eventManager),e.vo.Mo=Ih.bind(null,e.eventManager),e}function ul(t){var e=qr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Uh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qh.bind(null,e),e}var cl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return this.R=kc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Ku(this.persistence,new Vu,t.initialUser,this.R)},t.prototype.qo=function(t){return new lc(dc.bs,this.R)},t.prototype.Bo=function(t){return new _c},t.prototype.terminate=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),hl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Dr.c)(e,t),e.prototype.initialize=function(e){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,ec(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,ul(this.Ko.syncEngine)];case 4:return n.sent(),[4,eh(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Ku(this.persistence,new Vu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new wu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Mu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?iu.withCacheSize(this.cacheSizeBytes):iu.DEFAULT;return new Pu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Cc(),xc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new _c},e}(cl),ll=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Dr.c)(e,t),e.prototype.initialize=function(e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r=this;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Tc?(this.sharedClientState.syncEngine={ui:tl.bind(null,n),ai:ol.bind(null,n),hi:sl.bind(null,n),fn:il.bind(null,n),ci:Zh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Dr.b)(r,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return[4,el(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Cc();if(!Tc.yt(e))throw new xr(Cr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Mu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Tc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(hl),fl=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n=this;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Mh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Yh.bind(null,this.syncEngine),[4,uh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new vh},t.prototype.createDatastore=function(t){var e=kc(t.databaseInfo.databaseId),n=new Nc(t.databaseInfo);return function(t,e,n){return new Mc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Mh(s.syncEngine,t,0)},o=Sc.yt()?new Sc:new Oc,new Uc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new xh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e=qr(t),Pr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Vc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),dl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),pl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ta,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new _h(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Dr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new xr(Cr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Dr.d)(this,function(u){switch(u.label){case 0:return n=qr(t),r=Ps(n.R)+"/documents",i={documents:e.map(function(t){return Cs(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Ur(!!e.found);var n=xs(t,e.found.name),r=As(e.found.updateTime),i=new Ai({mapValue:{fields:e.found.fields}});return Ni.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Ur(!!e.missing),Ur(!!e.readTime);var n=xs(t,e.missing),r=As(e.readTime);return Ni.newNoDocument(n,r)}(t,e):Fr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Ur(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new zo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Dr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=di.fromPath(n);e.mutations.push(new Ho(r,e.precondition(r)))}),[4,function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return n=qr(t),r=Ps(n.R)+"/documents",i={writes:e.map(function(t){return Fs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Fr();e=Hr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new xr(Cr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?xo.updateTime(e):xo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Hr.min()))throw new xr(Cr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return xo.updateTime(e)}return xo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),yl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new jc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Dr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Dr.d)(this,function(r){return t=new pl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!hi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Xo(e)}return!1},t}(),ml=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=pc.UNAUTHENTICATED,this.clientId=Br.u(),this.credentialListener=function(){},this.receivedInitialUser=new Ta,this.credentials.setChangeListener(function(t){Pr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}return t.prototype.getConfiguration=function(){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new xr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ta;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Dr.b)(t,void 0,void 0,function(){var t,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=fh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function vl(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Pr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable(function(){return Object(Dr.b)(i,void 0,void 0,function(){return Object(Dr.d)(this,function(t){switch(t.label){case 0:return[4,Qu(e.localStore,n)];case 1:return t.sent(),[2]}})})}))}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function gl(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,bl(t)];case 1:return n=i.sent(),Pr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(n){return t.asyncQueue.enqueueRetryable(function(){return function(t,e){return Object(Dr.b)(this,void 0,void 0,function(){var n,r;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return(n=qr(t)).asyncQueue.verifyOperationInProgress(),Pr("RemoteStore","RemoteStore received new credentials"),r=Wc(n),n.$r.add(3),[4,Vc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,qc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,n)})}),t.onlineComponents=e,[2]}})})}function bl(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Pr("FirestoreClient","Using default OfflineComponentProvider"),[4,vl(t,new cl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function wl(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Pr("FirestoreClient","Using default OnlineComponentProvider"),[4,gl(t,new fl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Il(t){return bl(t).then(function(t){return t.persistence})}function El(t){return bl(t).then(function(t){return t.localStore})}function Tl(t){return wl(t).then(function(t){return t.remoteStore})}function _l(t){return wl(t).then(function(t){return t.syncEngine})}function Ol(t){return Object(Dr.b)(this,void 0,void 0,function(){var e,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return[4,wl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=kh.bind(null,e.syncEngine),n.onUnlisten=Ph.bind(null,e.syncEngine),n)]}})})}function Sl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(r,void 0,void 0,function(){var r;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new dl({next:function(o){e.enqueueAndForget(function(){return bh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new xr(Cr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new xr(Cr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Th($i(n.path),o,{includeMetadataChanges:!0,so:!0});return gh(t,s)},[4,Ol(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Al(t,e,n){var r=this;void 0===n&&(n={});var i=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(r,void 0,void 0,function(){var r;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new dl({next:function(n){e.enqueueAndForget(function(){return bh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new xr(Cr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Th(n,o,{includeMetadataChanges:!0,so:!0});return gh(t,s)},[4,Ol(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Dl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Nl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Cl=new Map,xl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},kl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(pc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),jl=function(){function t(t){var e=this;this.oc=null,this.currentUser=pc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then(function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Pr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Ur("string"==typeof n.accessToken),new xl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Ur(null===t||"string"==typeof t),new pc(t)},t}(),Pl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=pc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),Rl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new Pl(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(pc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Ll(t,e,n){if(!n)throw new xr(Cr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ml(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new xr(Cr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Fl(t,e,n,r){if(!0===e&&!0===r)throw new xr(Cr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Ul(t){if(!di.isDocumentKey(t))throw new xr(Cr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function ql(t){if(di.isDocumentKey(t))throw new xr(Cr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Vl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Fr()}function Bl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new xr(Cr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Vl(t);throw new xr(Cr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Kl(t,e){if(e<=0)throw new xr(Cr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ql=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new xr(Cr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new xr(Cr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Fl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Gl=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new Ql({}),this._settingsFrozen=!1,t instanceof Nl?(this._databaseId=t,this._credentials=new kl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new xr(Cr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Nl(t.options.projectId)}(t),this._credentials=new jl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new xr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new xr(Cr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ql(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new kl;switch(t.type){case"gapi":var e=t.client;return Ur(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Rl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new xr(Cr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Cl.get(this))&&(Pr("ComponentProvider","Removing Datastore"),Cl.delete(this),t.terminate()),Promise.resolve();var t},t}(),zl=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Wl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Hl=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Wl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,$i(r))||this)._path=r,i.type="collection",i}return Object(Dr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new zl(this.firestore,null,new di(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Hl);function Xl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(_.m)(t),Ll("collection","path",e),t instanceof Gl)return ql(n=$r.fromString.apply($r,Object(Dr.f)([e],r))),new Wl(t,null,n);if(!(t instanceof zl||t instanceof Wl))throw new xr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ql(n=$r.fromString.apply($r,Object(Dr.f)([t.path],r)).child($r.fromString(e))),new Wl(t.firestore,null,n)}function Yl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(_.m)(t),1===arguments.length&&(e=Br.u()),Ll("doc","path",e),t instanceof Gl)return Ul(n=$r.fromString.apply($r,Object(Dr.f)([e],r))),new zl(t,null,new di(n));if(!(t instanceof zl||t instanceof Wl))throw new xr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ul(n=t._path.child($r.fromString.apply($r,Object(Dr.f)([e],r)))),new zl(t.firestore,t instanceof Wl?t._converter:null,new di(n))}function Jl(t,e){return t=Object(_.m)(t),e=Object(_.m)(e),(t instanceof zl||t instanceof Wl)&&(e instanceof zl||e instanceof Wl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function $l(t,e){return t=Object(_.m)(t),e=Object(_.m)(e),t instanceof Hl&&e instanceof Hl&&t.firestore===e.firestore&&ao(t._query,e._query)&&t._converter===e._converter}var Zl=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new jc(this,"async_queue_retry"),this.Ec=function(){var e=xc();e&&Pr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=xc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=xc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise(function(t){}):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.dc.push(t),e.Ac()})},t.prototype.Ac=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Dr.d)(this,function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!Na(t=n.sent()))throw t;return Pr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji(function(){return e.Ac()}),n.label=5;case 5:return[2]}})})},t.prototype.Ic=function(t){var e=this,n=this.fc.then(function(){return e.yc=!0,t().catch(function(t){throw e.mc=t,e.yc=!1,Rr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.yc=!1,t})});return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=lh.createAndSchedule(this,t,e,n,function(t){return r.Rc(t)});return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&Fr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return Object(Dr.b)(this,void 0,void 0,function(){var t;return Object(Dr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then(function(){e._c.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()})},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function tf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Ta,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var ef=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Zl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Dr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||rf(this),this._firestoreClient.terminate()},e}(Gl);function nf(t){return t._firestoreClient||rf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function rf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Dl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ml(t._credentials,t._queue,r)}function of(t,e,n){var r=this,i=new Ta;return t.asyncQueue.enqueue(function(){return Object(Dr.b)(r,void 0,void 0,function(){var r;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,vl(t,n)];case 1:return o.sent(),[4,gl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Cr.FAILED_PRECONDITION||t.code===Cr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function sf(t){if(t._initialized||t._terminated)throw new xr(Cr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var af=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new xr(Cr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ti(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),uf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ni.fromBase64String(e))}catch(e){throw new xr(Cr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ni.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),cf=function(t){this._methodName=t},hf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new xr(Cr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new xr(Cr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Kr(this._lat,t._lat)||Kr(this._long,t._long)},t}(),lf=/^__.*__$/,ff=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new qo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Uo(t,this.data,e,this.fieldTransforms)},t}(),df=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new qo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function pf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fr()}}var yf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return Rf(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(pf(this.Dc)&&lf.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),mf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||kc(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new yf({Dc:t,methodName:e,Lc:n,path:ti.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function vf(t){var e=t._freezeSettings(),n=kc(t._databaseId);return new mf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function gf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);xf("Data must be an object, but it was:",s,r);var a,u,c=Nf(r,s);if(o.merge)a=new ei(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=kf(e,f[l],n);if(!s.contains(d))throw new xr(Cr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Lf(h,d)||h.push(d)}a=new ei(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new ff(new Ai(c),a,u)}var bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw t.$c(1===t.Dc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(cf);function wf(t,e,n){return new yf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var If=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype._toFieldTransform=function(t){return new No(t.path,new Io)},e.prototype.isEqual=function(t){return t instanceof e},e}(cf),Ef=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Dr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=wf(this,t,!0),n=this.qc.map(function(t){return Df(t,e)}),r=new Eo(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(cf),Tf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Dr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=wf(this,t,!0),n=this.qc.map(function(t){return Df(t,e)}),r=new _o(n);return new No(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(cf),_f=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Dr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new So(t.R,mo(t.R,this.Uc));return new No(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(cf);function Of(t,e,n,r){var i=t.Bc(1,e,n);xf("Data must be an object, but it was:",i,r);var o=[],s=Ai.empty();Xr(r,function(t,r){var a=Pf(e,t,n);r=Object(_.m)(r);var u=i.kc(a);if(r instanceof bf)o.push(a);else{var c=Df(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new ei(o);return new df(s,a,i.fieldTransforms)}function Sf(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[kf(e,r,n)],u=[i];if(o.length%2!=0)throw new xr(Cr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(kf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ai.empty(),f=a.length-1;f>=0;--f)if(!Lf(h,a[f])){var d=a[f],p=u[f];p=Object(_.m)(p);var y=s.kc(d);if(p instanceof bf)h.push(d);else{var m=Df(p,y);null!=m&&(h.push(d),l.set(d,m))}}var v=new ei(h);return new df(l,v,s.fieldTransforms)}function Af(t,e,n,r){return void 0===r&&(r=!1),Df(n,t.Bc(r?4:3,e))}function Df(t,e){if(Cf(t=Object(_.m)(t)))return xf("Unsupported field value:",e,t),Nf(t,e);if(t instanceof cf)return function(t,e){if(!pf(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Df(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(_.m)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return mo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=zr.fromDate(t);return{timestampValue:_s(e.R,n)}}if(t instanceof zr)return n=new zr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:_s(e.R,n)};if(t instanceof hf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof uf)return{bytesValue:Os(e.R,t._byteString)};if(t instanceof zl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ds(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+Vl(t))}(t,e)}function Nf(t,e){var n={};return Yr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xr(t,function(t,r){var i=Df(r,e.Nc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Cf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof zr||t instanceof hf||t instanceof uf||t instanceof zl||t instanceof cf)}function xf(t,e,n){if(!Cf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Vl(n);throw e.$c("an object"===r?t+" a custom object":t+" "+r)}}function kf(t,e,n){if((e=Object(_.m)(e))instanceof af)return e._internalPath;if("string"==typeof e)return Pf(t,e);throw Rf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var jf=new RegExp("[~\\*/\\[\\]]");function Pf(t,e,n){if(e.search(jf)>=0)throw Rf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(af.bind.apply(af,Object(Dr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Rf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Rf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new xr(Cr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Lf(t,e){return t.some(function(t){return t.isEqual(e)})}var Mf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new zl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Ff(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Uf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Ff=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Mf);function Uf(t,e){return"string"==typeof e?Pf(t,e):e instanceof af?e._internalPath:e._delegate._internalPath}var qf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Vf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Dr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Bf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Uf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Mf),Bf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Vf),Kf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new qf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Bf(n._firestore,n._userDataWriter,r.key,r,new qf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new xr(Cr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Bf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new qf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Bf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new qf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Qf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Qf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fr()}}function Gf(t,e){return t instanceof Vf&&e instanceof Vf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Kf&&e instanceof Kf&&t._firestore===e._firestore&&$l(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function zf(t){if(to(t)&&0===t.explicitOrderBy.length)throw new xr(Cr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Hf=function(){};function Wf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Xf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return Object(Dr.c)(e,t),e.prototype._apply=function(t){var e=vf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new xr(Cr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){nd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(ed(r,t,h[c]));a={arrayValue:{values:u}}}else a=ed(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||nd(s,o),a=Af(n,"where",s,"in"===o||"not-in"===o);var l=Ri.create(i,o,a);return function(t,e){if(e.g()){var n=no(t);if(null!==n&&!n.isEqual(e.field))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=eo(t);null!==r&&rd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new xr(Cr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Hl(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new Yi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Hf),Yf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return Object(Dr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new zi(e,n);return function(t,e){if(null===eo(t)){var n=no(t);null!==n&&rd(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Hl(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Yi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Hf),Jf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return Object(Dr.c)(e,t),e.prototype._apply=function(t){return new Hl(t.firestore,t._converter,so(t._query,this.Gc,this.zc))},e}(Hf),$f=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Dr.c)(e,t),e.prototype._apply=function(t){var e=td(t,this.type,this.Hc,this.Jc);return new Hl(t.firestore,t._converter,function(t,e){return new Yi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Hf),Zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Dr.c)(e,t),e.prototype._apply=function(t){var e=td(t,this.type,this.Hc,this.Jc);return new Hl(t.firestore,t._converter,function(t,e){return new Yi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Hf);function td(t,e,n,r){if(n[0]=Object(_.m)(n[0]),n[0]instanceof Mf)return function(t,e,n,r,i){if(!r)throw new xr(Cr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=io(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ii(e,r.key));else{var c=r.data.field(u.field);if(ai(c))throw new xr(Cr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Qi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=vf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new xr(Cr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!ro(t)&&-1!==c.indexOf("/"))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child($r.fromString(c));if(!di.isDocumentKey(h))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new di(h);a.push(Ii(e,l))}else{var f=Af(n,r,c);a.push(f)}}return new Qi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function ed(t,e,n){if("string"==typeof(n=Object(_.m)(n))){if(""===n)throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ro(e)&&-1!==n.indexOf("/"))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child($r.fromString(n));if(!di.isDocumentKey(r))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ii(t,new di(r))}if(n instanceof zl)return Ii(t,n._key);throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Vl(n)+".")}function nd(t,e){if(!Array.isArray(t)||0===t.length)throw new xr(Cr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new xr(Cr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function rd(t,e,n){if(!n.isEqual(e))throw new xr(Cr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var id=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),pi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return oi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(si(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Fr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Xr(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new hf(oi(t.latitude),oi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ui(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ci(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ii(t);return new zr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=$r.fromString(t);Ur(Zs(n));var r=new Nl(n.get(1),n.get(3)),i=new di(n.popFirst(5));return r.isEqual(e)||Rr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function od(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var sd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Dr.c)(e,t),e.prototype.convertBytes=function(t){return new uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new zl(this.firestore,null,e)},e}(id),ad=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=vf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=ud(t,this._firestore),i=od(r._converter,e,n),o=gf(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,xo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=ud(t,this._firestore);return o="string"==typeof(e=Object(_.m)(e))||e instanceof af?Sf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Of(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,xo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=ud(t,this._firestore);return this._mutations=this._mutations.concat(new zo(e._key,xo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new xr(Cr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function ud(t,e){if((t=Object(_.m)(t)).firestore!==e)throw new xr(Cr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var cd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Dr.c)(e,t),e.prototype.convertBytes=function(t){return new uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new zl(this.firestore,null,e)},e}(id);function hd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Bl(t,zl);var o=Bl(t.firestore,ef),s=vf(o);return fd(o,[("string"==typeof(e=Object(_.m)(e))||e instanceof af?Sf(s,"updateDoc",t._key,e,n,r):Of(s,"updateDoc",t._key,e)).toMutation(t._key,xo.exists(!0))])}function ld(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(_.m)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||tf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(tf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof zl)c=Bl(t.firestore,ef),h=$i(t._key.path),u={next:function(e){i[a]&&i[a](dd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Bl(t,Hl);c=Bl(d.firestore,ef),h=d._query;var p=new cd(c);u={next:function(t){i[a]&&i[a](new Kf(c,p,d,t))},error:i[a+1],complete:i[a+2]},zf(t._query)}return function(t,e,n,r){var i=this,o=new dl(r),s=new Th(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(i,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e=gh,[4,Ol(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(i,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e=bh,[4,Ol(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(nf(c),h,l,u)}function fd(t,e){return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var n;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return n=Rh,[4,_l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(nf(t),e)}function dd(t,e,n){var r=n.docs.get(e._key),i=new cd(t);return new Vf(t,i,e._key,r,new qf(n.hasPendingWrites,n.fromCache),e._converter)}var pd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Dr.c)(e,t),e.prototype.get=function(e){var n=this,r=ud(e,this._firestore),i=new cd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Vf(n._firestore,i,r._key,t._document,new qf(!1,!1),r._converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=vf(t)}return t.prototype.get=function(t){var e=this,n=ud(t,this._firestore),r=new sd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Fr();var i=t[0];if(i.isFoundDocument())return new Mf(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new Mf(e._firestore,r,n._key,null,n._converter);throw Fr()})},t.prototype.set=function(t,e,n){var r=ud(t,this._firestore),i=od(r._converter,e,n),o=gf(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=ud(t,this._firestore);return o="string"==typeof(e=Object(_.m)(e))||e instanceof af?Sf(this._dataReader,"Transaction.update",s._key,e,n,r):Of(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=ud(t,this._firestore);return this._transaction.delete(e._key),this},t}());function yd(){if("undefined"==typeof Uint8Array)throw new xr(Cr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function md(){if("undefined"==typeof atob)throw new xr(Cr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var vd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return md(),new t(uf.fromBase64String(e))},t.fromUint8Array=function(e){return yd(),new t(uf.fromUint8Array(e))},t.prototype.toBase64=function(){return md(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return yd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),gd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){sf(t=Bl(t,ef));var n=nf(t),r=t._freezeSettings(),i=new fl;return of(n,i,new hl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){sf(t=Bl(t,ef));var e=nf(t),n=t._freezeSettings(),r=new fl;return of(e,r,new ll(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new xr(Cr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ta;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Dr.b)(e,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Dr.b)(this,void 0,void 0,function(){return Object(Dr.d)(this,function(e){switch(e.label){case 0:return Sa.yt()?[4,Sa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Mu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),bd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Nl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Bl(t,Gl))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&Lr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Dr.b)(e,void 0,void 0,function(){var e,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return[4,Il(t)];case 1:return e=r.sent(),[4,Tl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=qr(t);return e.$r.delete(0),qc(e)}(n))]}})})})}(nf(Bl(this._delegate,ef)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Dr.b)(e,void 0,void 0,function(){var e,n;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return[4,Il(t)];case 1:return e=r.sent(),[4,Tl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Dr.b)(this,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return(e=qr(t)).$r.add(0),[4,Vc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(nf(Bl(this._delegate,ef)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Fl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(e,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(r){switch(r.label){case 0:return e=Vh,[4,_l(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(nf(Bl(this._delegate,ef)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new dl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){qr(t).Gr.add(e),e.next()},[4,Ol(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var e;return Object(Dr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){qr(t).Gr.delete(e)},[4,Ol(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(nf(t=Bl(t,ef)),tf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new xr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new jd(this,Xl(this._delegate,t))}catch(t){throw Od(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new _d(this,Yl(this._delegate,t))}catch(t){throw Od(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Cd(this,function(t,e){if(t=Bl(t,Gl),Ll("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new xr(Cr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Hl(t,null,function(t){return new Yi($r.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Od(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var n;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return wl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new yl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(nf(t),function(n){return e(new pd(t,n))})}(this._delegate,function(n){return t(new Id(e,n))})},t.prototype.batch=function(){var t=this;return nf(this._delegate),new Ed(new ad(this._delegate,function(e){return fd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new xr(Cr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new xr(Cr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),wd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Dr.c)(e,t),e.prototype.convertBytes=function(t){return new vd(new uf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return _d.Zc(e,this.firestore,null)},e}(id),Id=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new wd(t)}return t.prototype.get=function(t){var e=this,n=Pd(t);return this._delegate.get(n).then(function(t){return new Dd(e._firestore,new Vf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},t.prototype.set=function(t,e,n){var r=Pd(t);return n?(Ml("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Pd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Dr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Pd(t);return this._delegate.delete(e),this},t}(),Ed=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Pd(t);return n?(Ml("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Pd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Dr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Pd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Td=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Bf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Nd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new wd(e),n),i.set(n,o)),o},t}();Td.eu=new WeakMap;var _d=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new wd(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new xr(Cr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new zl(n._delegate,r,new di(e)))},t.Zc=function(e,n,r){return new t(n,new zl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new jd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new jd(this.firestore,Xl(this._delegate,t))}catch(t){throw Od(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(_.m)(t))instanceof zl&&Jl(this._delegate,t)},t.prototype.set=function(t,e){e=Ml("DocumentReference.set",e);try{return function(t,e,n){t=Bl(t,zl);var r=Bl(t.firestore,ef),i=od(t._converter,e,n);return fd(r,[gf(vf(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,xo.none())])}(this._delegate,t,e)}catch(t){throw Od(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?hd(this._delegate,t):hd.apply(void 0,Object(Dr.f)([this._delegate,t,e],n))}catch(t){throw Od(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return fd(Bl((t=this._delegate).firestore,ef),[new zo(t._key,xo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Sd(e),i=Ad(e,function(e){return new Dd(t.firestore,new Vf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))});return ld(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var n;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i;return Object(Dr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=qr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new xr(Cr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=fh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Vf(e,r,t._key,n,new qf(null!==n&&n.hasLocalMutations,!0),t._converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef);return Sl(nf(e),t._key,{source:"server"}).then(function(n){return dd(e,t,n)})}(this._delegate):function(t){t=Bl(t,zl);var e=Bl(t.firestore,ef);return Sl(nf(e),t._key).then(function(n){return dd(e,t,n)})}(this._delegate)).then(function(t){return new Dd(e.firestore,new Vf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Td.tu(this.firestore,e):null))},t}();function Od(t,e,n){return t.message=t.message.replace(e,n),t}function Sd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!tf(r))return r}return{}}function Ad(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=tf(t[0])?t[0]:tf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Dd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new _d(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Gf(this._delegate,t._delegate)},t}(),Nd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Dr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Dd),Cd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new wd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Wf(this._delegate,function(t,e,n){var r=e,i=Uf("where",t);return new Xf(i,r,n)}(e,n,r)))}catch(e){throw Od(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Wf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Uf("orderBy",t);return new Yf(r,n)}(e,n)))}catch(e){throw Od(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Wf(this._delegate,function(t){return Kl("limit",t),new Jf("limit",t,"F")}(e)))}catch(e){throw Od(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Wf(this._delegate,function(t){return Kl("limitToLast",t),new Jf("limitToLast",t,"L")}(e)))}catch(e){throw Od(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Od(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new $f("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Od(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zf("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Od(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Wf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zf("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Od(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return $l(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return function(t,e){var n=this,r=new Ta;return t.asyncQueue.enqueueAndForget(function(){return Object(Dr.b)(n,void 0,void 0,function(){var n;return Object(Dr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Dr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Dr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,$u(t,e,!0)];case 1:return a=u.sent(),r=new Dh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=fh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Kf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return Al(n,t._query,{source:"server"}).then(function(n){return new Kf(e,r,t,n)})}(this._delegate):function(t){t=Bl(t,Hl);var e=Bl(t.firestore,ef),n=nf(e),r=new cd(e);return zf(t._query),Al(n,t._query).then(function(n){return new Kf(e,r,t,n)})}(this._delegate)).then(function(t){return new kd(e.firestore,new Kf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Sd(e),i=Ad(e,function(e){return new kd(t.firestore,new Kf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return ld(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Td.tu(this.firestore,e):null))},t}(),xd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Nd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Cd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Nd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new xd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Nd(n._firestore,r))})},t.prototype.isEqual=function(t){return Gf(this._delegate,t._delegate)},t}(),jd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Dr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new _d(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new _d(this.firestore,void 0===t?Yl(this._delegate):Yl(this._delegate,t))}catch(t){throw Od(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Bl(t.firestore,ef),r=Yl(t),i=od(t._converter,e);return fd(n,[gf(vf(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,xo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new _d(e.firestore,t)})},e.prototype.isEqual=function(t){return Jl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Td.tu(this.firestore,t):null))},e}(Cd);function Pd(t){return Bl(t,zl)}var Rd,Ld=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(af.bind.apply(af,Object(Dr.f)([void 0],t)))}return t.documentId=function(){return new t(ti.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(_.m)(t))instanceof af&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Md=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new If("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new bf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ef("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new _f("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Fd=n("/6Yf"),Ud={Firestore:bd,GeoPoint:hf,Timestamp:zr,Blob:vd,Transaction:Id,WriteBatch:Ed,DocumentReference:_d,DocumentSnapshot:Dd,Query:Cd,QueryDocumentSnapshot:Nd,QuerySnapshot:kd,CollectionReference:jd,FieldPath:Ld,FieldValue:Md,setLogLevel:function(t){kr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Fd.a("firestore",function(t){return function(t,e){return new bd(t,new ef(t,e),new gd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Ud)))})(Rd=T.a),Rd.registerVersion("@firebase/firestore","2.2.5");var qd=n("VRCc");function Vd(t,e){return function(t,e=a.a){return new s.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Bd(t,e){return Vd(t,e).pipe(Object(y.a)(t=>({payload:t,type:"query"})))}function Kd(t,e){return Bd(t,e).pipe(Object(h.a)(void 0),f(),Object(y.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Qd(t,e,n){return Kd(t,n).pipe(Object(m.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Gd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Gd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Gd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(v.a)(),Object(y.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Gd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function zd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Hd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Kd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(y.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(h.a)(void 0),f(),Object(g.a)(([t,e])=>e.length>0||!t),Object(y.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(m.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=zd(t);return Qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Bd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(y.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(u.a)(this.query.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Wd(this.ref.doc(t),this.afs)}}class Wd{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=tp(n,e);return new Hd(r,i,this.afs)}snapshotChanges(){return Vd(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(void 0),f(),Object(y.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(y.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(u.a)(this.ref.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}}class Xd{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Kd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(y.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(g.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Kd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(m.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=zd(t);return Qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Bd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(y.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(u.a)(this.query.get(t)).pipe(Object(b.b)(this.afs.schedulers.insideAngular))}}const Yd=new o.r("angularfire2.enableFirestorePersistence"),Jd=new o.r("angularfire2.firestore.persistenceSettings"),$d=new o.r("angularfire2.firestore.settings"),Zd=new o.r("angularfire2.firestore.use-emulator");function tp(t,e=(t=>t)){return{query:e(t),ref:t}}let ep=(()=>{class t{constructor(t,e,n,r,i,o,s,a,h){this.schedulers=new w.d(o),this.keepUnstableUntilFirst=Object(w.h)(this.schedulers);const l=Object(w.g)(t,o,e);!E.a.auth&&h&&Object(w.j)();const f=a;[this.firestore,this.persistenceEnabled$]=Object(w.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(I.o)(i)){const e=()=>{try{return Object(u.a)(t.enablePersistence(s||void 0).then(()=>!0,()=>!1))}catch(Rd){return"undefined"!=typeof console&&console.warn(Rd),Object(c.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(c.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=tp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Hd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Xd(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Wd(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.Ub(w.c),o.Ub(w.b,8),o.Ub(Yd,8),o.Ub($d,8),o.Ub(o.C),o.Ub(o.A),o.Ub(Jd,8),o.Ub(Zd,8),o.Ub(qd.a,8))},t.\u0275prov=Object(o.Hb)({factory:function(){return new t(Object(o.Ub)(w.c),Object(o.Ub)(w.b,8),Object(o.Ub)(Yd,8),Object(o.Ub)($d,8),Object(o.Ub)(o.C),Object(o.Ub)(o.A),Object(o.Ub)(Jd,8),Object(o.Ub)(Zd,8),Object(o.Ub)(qd.a,8))},token:t,providedIn:"any"}),t})(),np=(()=>{class t{constructor(t){this.firestore=t,this.contactDetails=[],this.activeContactId=""}getContactDetails(){var t=new Array;return new s.a(e=>{this.firestore.collection("contact-list").snapshotChanges().subscribe(n=>{t=[],n.map(e=>{let n=e.payload.doc.data(),r=Object.assign({id:e.payload.doc.id},n);t.push(r)}),e.next(0!=t.length?{contacts:t,status:!0}:{contacts:null,status:!1})})})}getDetails(){const t=new Array;return new s.a(e=>{const n=this.firestore.collection("contact-list").get().subscribe(r=>{r&&(r.forEach(e=>{const n=e.data();n.id=e.id,t.push(n)}),e.next(t)),n&&n.unsubscribe()})})}getContact(t){return this.activeContactId=t,new s.a(e=>{this.contactDetails=[],this.firestore.doc("contact-list/"+t).get().subscribe(t=>{if(t&&t.exists){const n=t.data();e.next({contact:n,status:!0})}else e.next({contact:null,status:!1})})})}deleteContact(t){this.activeContactId="",this.firestore.doc("contact-list/"+t).delete()}addContact(t){return this.firestore.collection("contact-list").add(t)}UpdateContact(t){this.firestore.doc("contact-list/"+t.id).set({name:t.name,email:t.email,mobile:t.mobile,landline:t.landline,website:t.website,address:t.address})}}return t.\u0275fac=function(e){return new(e||t)(o.Ub(ep))},t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var rp=n("tyNb"),ip=n("5eHb"),op=n("xJkR");const sp=function(t){return["/home/contacts",t]},ap=function(t){return{"activePerson text-dark":t}};function up(t,e){if(1&t&&(o.Qb(0,"div",10),o.Qb(1,"a",11),o.Qb(2,"li",12),o.mc(3),o.Pb(),o.Qb(4,"li"),o.mc(5),o.Pb(),o.Qb(6,"li"),o.mc(7),o.Pb(),o.Pb(),o.Pb()),2&t){const t=e.$implicit,n=o.Zb(2);o.Ab(1),o.ac("routerLink",o.cc(5,sp,null==t?null:t.id))("ngClass",o.cc(7,ap,(null==t?null:t.id)==n.id)),o.Ab(2),o.nc(null==t?null:t.name),o.Ab(2),o.nc(null==t?null:t.mobile),o.Ab(2),o.nc(null==t?null:t.email)}}const cp=function(){return{width:"100%",height:"50px","margin-top":"10px"}};function hp(t,e){1&t&&o.Mb(0,"ngx-skeleton-loader",13),2&t&&o.ac("theme",o.bc(1,cp))}function lp(t,e){1&t&&(o.Qb(0,"div",36),o.mc(1,"Name is required"),o.Pb())}function fp(t,e){if(1&t&&(o.Qb(0,"div",34),o.lc(1,lp,2,0,"div",35),o.Pb()),2&t){const t=o.Zb(3);o.Ab(1),o.ac("ngIf",t.detailForm.controls.name.errors.required)}}function dp(t,e){1&t&&(o.Qb(0,"div",36),o.mc(1,"Email is required"),o.Pb())}function pp(t,e){1&t&&(o.Qb(0,"div",36),o.mc(1,"Enter valid email"),o.Pb())}function yp(t,e){if(1&t&&(o.Qb(0,"div",34),o.lc(1,dp,2,0,"div",35),o.lc(2,pp,2,0,"div",35),o.Pb()),2&t){const t=o.Zb(3);o.Ab(1),o.ac("ngIf",t.detailForm.controls.email.errors.required),o.Ab(1),o.ac("ngIf",t.detailForm.controls.email.errors.email)}}function mp(t,e){1&t&&(o.Qb(0,"div",36),o.mc(1,"Mobile is required"),o.Pb())}function vp(t,e){1&t&&(o.Qb(0,"div",36),o.mc(1,"Mobile should be 10 digits"),o.Pb())}function gp(t,e){if(1&t&&(o.Qb(0,"div",34),o.lc(1,mp,2,0,"div",35),o.lc(2,vp,2,0,"div",35),o.Pb()),2&t){const t=o.Zb(3);o.Ab(1),o.ac("ngIf",t.detailForm.controls.mobile.errors.required),o.Ab(1),o.ac("ngIf",t.detailForm.controls.mobile.errors&&!t.detailForm.controls.mobile.errors.required)}}const bp=function(t){return{"is-invalid":t}};function wp(t,e){if(1&t){const t=o.Rb();o.Qb(0,"form",14),o.Xb("ngSubmit",function(){o.fc(t);const e=o.Zb(2);return e.onSubmit(e.detailForm.value)}),o.Qb(1,"div",15),o.Qb(2,"label",16),o.mc(3,"Name "),o.Qb(4,"span",17),o.mc(5,"*"),o.Pb(),o.Pb(),o.Mb(6,"input",18),o.lc(7,fp,2,1,"div",19),o.Qb(8,"label",20),o.mc(9,"Email "),o.Qb(10,"span",17),o.mc(11,"*"),o.Pb(),o.Pb(),o.Mb(12,"input",21),o.lc(13,yp,3,2,"div",19),o.Qb(14,"div",22),o.Qb(15,"div"),o.Qb(16,"label",23),o.mc(17,"Mobile "),o.Qb(18,"span",17),o.mc(19,"*"),o.Pb(),o.Pb(),o.Mb(20,"input",24),o.lc(21,gp,3,2,"div",19),o.Pb(),o.Qb(22,"div",25),o.Qb(23,"label",26),o.mc(24,"Landline"),o.Pb(),o.Mb(25,"input",27),o.Pb(),o.Pb(),o.Qb(26,"label",28),o.mc(27,"Website"),o.Pb(),o.Mb(28,"input",29),o.Qb(29,"label",30),o.mc(30,"Address"),o.Pb(),o.Mb(31,"textarea",31),o.Pb(),o.Qb(32,"div",32),o.Mb(33,"input",33),o.Pb(),o.Pb()}if(2&t){const t=o.Zb(2);o.ac("formGroup",t.detailForm),o.Ab(6),o.ac("ngClass",o.cc(7,bp,t.detailForm.controls.name.errors&&t.submitted)),o.Ab(1),o.ac("ngIf",t.submitted&&t.detailForm.controls.name.errors),o.Ab(5),o.ac("ngClass",o.cc(9,bp,t.detailForm.controls.email.errors&&t.submitted)),o.Ab(1),o.ac("ngIf",t.submitted&&t.detailForm.controls.email.errors),o.Ab(7),o.ac("ngClass",o.cc(11,bp,t.detailForm.controls.mobile.errors&&t.submitted)),o.Ab(1),o.ac("ngIf",t.submitted&&t.detailForm.controls.mobile.errors)}}function Ip(t,e){if(1&t&&(o.Qb(0,"div",2),o.Qb(1,"h6",3),o.mc(2,"CONTACTS"),o.Pb(),o.Qb(3,"div",4),o.Qb(4,"div"),o.lc(5,up,8,9,"div",5),o.Pb(),o.Pb(),o.Qb(6,"div",6),o.Qb(7,"div",7),o.lc(8,hp,1,2,"ngx-skeleton-loader",8),o.lc(9,wp,34,13,"form",9),o.Pb(),o.Pb(),o.Pb()),2&t){const t=o.Zb();o.Ab(5),o.ac("ngForOf",t.contactDetails),o.Ab(3),o.ac("ngIf",t.loadingForm),o.Ab(1),o.ac("ngIf",!t.loadingForm)}}function Ep(t,e){1&t&&(o.Qb(0,"div"),o.Mb(1,"img",37),o.Pb())}let Tp=(()=>{class t{constructor(t,e,n,r,o){this.service=t,this.formBuild=e,this.route=n,this.router=r,this.toastr=o,this.detailForm=new i.d({}),this.submitted=!1,this.contactDetails=[],this.status=!1,this.loading=!0,this.loadingForm=!0}createForm(){this.detailForm=this.formBuild.group({name:["",[i.j.required]],email:["",[i.j.required,i.j.email,i.j.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")]],mobile:["",[i.j.required,i.j.pattern(/^[6-9]\d{9}$/),i.j.maxLength(10)]],landline:[""],website:[""],address:[""]})}ngOnInit(){this.service.getContactDetails().subscribe(t=>{this.contactDetails=t.contacts,this.status=t.status,this.loading=!1}),this.id=this.route.snapshot.paramMap.get("id"),this.createForm(),null!=this.id?this.fillForm(this.id):(this.router.navigateByUrl("/add/contact"),this.loadingForm=!1)}fillForm(t){this.service.getContact(t).subscribe(t=>{let e=t.contact;this.loadingForm=!1,this.detailForm.setValue({name:e.name,email:e.email,mobile:e.mobile,landline:e.landline,website:e.website,address:e.address})})}onSubmit(t){if(this.detailForm.invalid)this.submitted=!0;else if(null!=this.id){let e=new r({id:this.id,name:t.name,email:t.email,mobile:t.mobile,landline:t.landline,website:t.website,address:t.address});this.service.UpdateContact(e),this.router.navigate(["/home/contacts",this.id]),this.toastr.success(t.name+" updated successfully","Message")}else{let e=this.service.addContact(t),n=this;this.toastr.success(t.name+" added successfully","Message"),e.then(function(t){n.service.activeContactId=t.id,n.router.navigate(["/home/contacts",t.id])})}}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(np),o.Lb(i.b),o.Lb(rp.a),o.Lb(rp.c),o.Lb(ip.b))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-contact-add"]],decls:2,vars:2,consts:[["class","row ms-2 mt-1",4,"ngIf"],[4,"ngIf"],[1,"row","ms-2","mt-1"],[1,"fw-bolder","pt-2","pb-1"],[1,"col-3"],["class","list-group rounded-0 border-dark",4,"ngFor","ngForOf"],[1,"col-5","ms-4"],[1,"addDetails"],["count","6",3,"theme",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"list-group","rounded-0","border-dark"],[1,"list-group-item","list-group-item-action",3,"routerLink","ngClass"],[1,"name"],["count","6",3,"theme"],[3,"formGroup","ngSubmit"],[1,"details"],["for","name",1,"form-label"],[1,"required"],["type","text","id","name","name","name","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","email",1,"form-label"],["type","email","id","email","name","email","formControlName","email",1,"form-control",3,"ngClass"],[1,"flex-container"],["for","mobile",1,"form-label"],["type","text","id","mobile","name","mobile","formControlName","mobile",1,"form-control",3,"ngClass"],[2,"margin-left","6px","margin-top","3px"],["for","landline",1,"form-label"],["type","text","id","landline","name","landline","formControlName","landline",1,"form-control"],["for","website",1,"form-label"],["type","text","id","website","name","website","formControlName","website",1,"form-control"],["for","address",1,"form-label"],["id","address","name","address","rows","2","formControlName","address",1,"form-control"],[2,"float","right"],["type","submit","value","Add",1,"btnAdd"],[1,"invalid-feedback"],["class","errormsg",4,"ngIf"],[1,"errormsg"],["src","../../../../assets/images/loader.gif","alt","loader","height","300px",1,"rounded","mx-auto","d-block"]],template:function(t,e){1&t&&(o.lc(0,Ip,10,3,"div",0),o.lc(1,Ep,2,0,"div",1)),2&t&&(o.ac("ngIf",!e.loading),o.Ab(1),o.ac("ngIf",e.loading))},directives:[I.j,I.i,rp.e,I.h,op.a,i.k,i.h,i.e,i.a,i.g,i.c],styles:[".col-3[_ngcontent-%COMP%]{width:260px}li[_ngcontent-%COMP%]{font-size:14px;list-style-type:none}.name[_ngcontent-%COMP%]{font-size:16px}.activePerson[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:hover{background-color:#cfe7f3;cursor:pointer}.addDetails[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{width:80%}.addDetails[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:13px;font-weight:700;margin-top:10px}.addDetails[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{font-size:15px;color:#e42e45;font-weight:400}.addDetails[_ngcontent-%COMP%]   .flex-container[_ngcontent-%COMP%]{display:flex}.btnAdd[_ngcontent-%COMP%]{width:95px;height:35px;float:right;font-size:small;font-size:12px;margin-top:14px;margin-bottom:14px;background-color:#27a844;border:1px solid #fff;border-radius:4px}.col-5[_ngcontent-%COMP%]{box-shadow:0 5px 15px rgba(0,0,0,.5);margin-left:10px}.errormsg[_ngcontent-%COMP%]{font-size:12px}"]}),t})();function _p(t,e){1&t&&(o.Qb(0,"h6",8),o.mc(1,"CONTACTS"),o.Pb())}const Op=function(t){return["/home/contacts",t]};function Sp(t,e){if(1&t&&(o.Qb(0,"div",9),o.Qb(1,"a",10),o.Qb(2,"li",11),o.mc(3),o.Pb(),o.Qb(4,"li"),o.mc(5),o.Pb(),o.Qb(6,"li"),o.mc(7),o.Pb(),o.Pb(),o.Pb()),2&t){const t=e.$implicit;o.Ab(1),o.ac("routerLink",o.cc(4,Op,null==t?null:t.id)),o.Ab(2),o.nc(null==t?null:t.name),o.Ab(2),o.nc(null==t?null:t.mobile),o.Ab(2),o.nc(null==t?null:t.email)}}function Ap(t,e){if(1&t&&(o.Qb(0,"div",3),o.lc(1,_p,2,0,"h6",4),o.Qb(2,"div",5),o.lc(3,Sp,8,6,"div",6),o.Pb(),o.Qb(4,"div",7),o.Mb(5,"router-outlet"),o.Pb(),o.Pb()),2&t){const t=o.Zb();o.Ab(1),o.ac("ngIf",t.status),o.Ab(2),o.ac("ngForOf",t.contactDetails)}}function Dp(t,e){1&t&&(o.Qb(0,"div",12),o.Qb(1,"span",13),o.Mb(2,"i",14),o.mc(3,"No Contacts To Display"),o.Pb(),o.Pb())}function Np(t,e){1&t&&(o.Qb(0,"div"),o.Mb(1,"img",15),o.Pb())}const Cp=function(){return{"border-radius":"0",height:"32px"}},xp=function(){return{"border-radius":"0",height:"15px"}};function kp(t,e){1&t&&(o.Qb(0,"div"),o.Qb(1,"div",3),o.Qb(2,"div",4),o.Qb(3,"div",5),o.Mb(4,"ngx-skeleton-loader",6),o.Mb(5,"ngx-skeleton-loader",7),o.Pb(),o.Pb(),o.Pb(),o.Pb()),2&t&&(o.Ab(4),o.ac("theme",o.bc(2,Cp)),o.Ab(1),o.ac("theme",o.bc(3,xp)))}function jp(t,e){if(1&t&&(o.Qb(0,"div",4),o.Qb(1,"h4"),o.mc(2),o.Pb(),o.Qb(3,"ul",10),o.Qb(4,"li"),o.mc(5),o.Pb(),o.Qb(6,"li"),o.mc(7),o.Pb(),o.Qb(8,"li"),o.mc(9),o.Pb(),o.Qb(10,"li"),o.mc(11),o.Pb(),o.Qb(12,"li"),o.Qb(13,"div",3),o.Qb(14,"div",11),o.mc(15," Address: "),o.Pb(),o.Qb(16,"div",12),o.Qb(17,"pre"),o.mc(18),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Pb(),o.Pb()),2&t){const t=o.Zb(2);o.Ab(2),o.nc(null==t.personDetails?null:t.personDetails.name),o.Ab(3),o.oc("Email: ",null==t.personDetails?null:t.personDetails.email,""),o.Ab(2),o.oc("Mobile: ",null==t.personDetails?null:t.personDetails.mobile,""),o.Ab(2),o.oc("Landline: ",null==t.personDetails?null:t.personDetails.landline,""),o.Ab(2),o.oc("Website: ",null==t.personDetails?null:t.personDetails.website,""),o.Ab(7),o.nc(null==t.personDetails?null:t.personDetails.address)}}function Pp(t,e){if(1&t){const t=o.Rb();o.Qb(0,"div",13),o.Qb(1,"img",14),o.Xb("click",function(){return o.fc(t),o.Zb(2).edit()}),o.Pb(),o.Qb(2,"span",15),o.Xb("click",function(){return o.fc(t),o.Zb(2).edit()}),o.mc(3,"EDIT"),o.Pb(),o.Qb(4,"img",16),o.Xb("click",function(){return o.fc(t),o.Zb(2).delete()}),o.Pb(),o.Qb(5,"span",15),o.Xb("click",function(){return o.fc(t),o.Zb(2).delete()}),o.mc(6,"DELETE"),o.Pb(),o.Pb()}}function Rp(t,e){if(1&t&&(o.Qb(0,"div",3),o.lc(1,jp,19,6,"div",8),o.lc(2,Pp,7,0,"div",9),o.Pb()),2&t){const t=o.Zb();o.Ab(1),o.ac("ngIf",t.status),o.Ab(1),o.ac("ngIf",t.status)}}function Lp(t,e){1&t&&(o.Qb(0,"div",17),o.Qb(1,"span",18),o.Mb(2,"i",19),o.mc(3,"Wrong User Id"),o.Pb(),o.Pb())}const Mp=[{path:"",redirectTo:"home/contacts",pathMatch:"full"},{path:"home/contacts",component:(()=>{class t{constructor(t,e,n){this.service=t,this.router=e,this.route=n,this.status=!1,this.loading=!0}ngOnInit(){this.service.getContactDetails().subscribe(t=>{this.contactDetails=t.contacts,this.status=t.status,this.loading=!1;var e=this.router.url;console.log(e),"/home/contacts"!=e?this.router.navigateByUrl(e):(this.service.activeContactId=this.contactDetails[0].id,this.router.navigate(["home/contacts",this.service.activeContactId]))})}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(np),o.Lb(rp.c),o.Lb(rp.a))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-contact-list"]],decls:3,vars:3,consts:[["class","row ms-2 mt-1",4,"ngIf"],["class","text-center mt-5 ",4,"ngIf"],[4,"ngIf"],[1,"row","ms-2","mt-1"],["class","fw-bolder pt-2 pb-1",4,"ngIf"],[1,"col-3","me-5","mt-1"],["class","list-group rounded-0",4,"ngFor","ngForOf"],[1,"col-9","mt-1"],[1,"fw-bolder","pt-2","pb-1"],[1,"list-group","rounded-0"],["routerLinkActive","activePerson text-dark",1,"list-group-item","list-group-item-action","border-1",3,"routerLink"],[1,"name"],[1,"text-center","mt-5"],[1,"display-6","text-danger"],[1,"fas","fa-info-circle","me-3"],["src","../../../../assets/images/loader.gif","alt","loader","height","300px",1,"rounded","mx-auto","d-block"]],template:function(t,e){1&t&&(o.lc(0,Ap,6,2,"div",0),o.lc(1,Dp,4,0,"div",1),o.lc(2,Np,2,0,"div",2)),2&t&&(o.ac("ngIf",e.status),o.Ab(1),o.ac("ngIf",!e.status&&!e.loading),o.Ab(1),o.ac("ngIf",e.loading))},directives:[I.j,I.i,rp.g,rp.e,rp.d],styles:[".col-3[_ngcontent-%COMP%]{width:260px}li[_ngcontent-%COMP%]{font-size:14px;list-style-type:none;color:#363535}.name[_ngcontent-%COMP%]{font-size:16px;color:#000}.activePerson[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:hover{background-color:#cfe7f3;cursor:pointer}"]}),t})(),children:[{path:":id",component:(()=>{class t{constructor(t,e,n,r){this.service=t,this.route=e,this.router=n,this.toastr=r,this.displayForm=!1,this.status=!1,this.loading=!0,this.wrongId="false",this.contactDetails=[]}delete(){this.service.deleteContact(this.currId),this.service.getDetails().subscribe(t=>{0!=t.length?(this.service.activeContactId=t[t.length-1].id,this.router.navigate(["home/contacts/",this.service.activeContactId])):(this.service.activeContactId="",this.router.navigate(["home/contacts/"]))}),this.toastr.success(this.personDetails.name+" delete successfully","Message")}edit(){this.router.navigate(["home/contacts/edit",this.currId])}ngOnInit(){this.currId=this.route.snapshot.paramMap.get("id"),this.router.events.subscribe(t=>{t instanceof rp.b&&(this.loading=!0,this.currId=this.route.snapshot.paramMap.get("id"),this.updateContact(this.currId))}),null!=this.currId?this.updateContact(this.currId):this.status=!1}updateContact(t){this.status=!0,this.service.getContact(t).subscribe(t=>{this.loading=!1,this.personDetails=t.contact,this.status=t.status})}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(np),o.Lb(rp.a),o.Lb(rp.c),o.Lb(ip.b))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-contact-show"]],decls:3,vars:3,consts:[[4,"ngIf"],["class","row",4,"ngIf"],["class","col-md-5 ms-3",4,"ngIf"],[1,"row"],[1,"col-md-4","me-5"],[1,"item"],["count","1",3,"theme"],["count","5",3,"theme"],["class","col-md-4 me-5",4,"ngIf"],["class","col-md-6",4,"ngIf"],[1,"list-group"],[1,"col-sm-2"],[1,"col-sm-10"],[1,"col-md-6"],["src","../../../../assets/images/Edit-icon.png ","alt","edit icon ","width","14px ","height","14px ",3,"click"],[1,"options",3,"click"],["src","../../../../assets/images/delete2.png ","alt","delete icon ","width","15px ","height","23px ",3,"click"],[1,"col-md-5","ms-3"],[1,"display-6","text-danger"],[1,"fas","fa-info-circle","me-3"]],template:function(t,e){1&t&&(o.lc(0,kp,6,4,"div",0),o.lc(1,Rp,3,2,"div",1),o.lc(2,Lp,4,0,"div",2)),2&t&&(o.ac("ngIf",e.loading&&e.status),o.Ab(1),o.ac("ngIf",!e.loading),o.Ab(1),o.ac("ngIf",!e.status))},directives:[I.j,op.a],styles:[".list-group[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style-type:none;font-size:14px;padding:2px 0}.options[_ngcontent-%COMP%]{margin-right:5px;margin-left:4px;font-size:14px}.options[_ngcontent-%COMP%], img[_ngcontent-%COMP%]{cursor:pointer}pre[_ngcontent-%COMP%]{padding-top:1.5px;font-size:14px;font-family:sans-serif}"]}),t})()}]},{path:"add/contact",component:Tp},{path:"home/contacts/edit/:id",component:Tp}];let Fp=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({imports:[[rp.f.forChild(Mp),I.b],rp.f]}),t})(),Up=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Jb({type:t}),t.\u0275inj=o.Ib({imports:[[Fp,rp.f,i.i,I.b,op.b]]}),t})()}}]);